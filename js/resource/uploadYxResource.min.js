function uploadBigFile(){var e=$.cookie("person_id"),t=$.cookie("person_name"),i=$.cookie("identity_id"),p=$.cookie("token"),a=NewGuid();null!=share&&(share_ids=share.sharerange("getRangeSel",1),checkboxids=share.sharerange("getRangeSel",2));var s=0;""!=share_ids&&(s=1);var r={filter:[file_filter],uploadOrDownload:!0,confirmUploadInfo:_action_path+url_path_action_login+"/wkds/clientSetUploadInfo",paramJson:{service_type:service_type,service_id:service_id,res_type:res_type,bk_type:hj_id,bk_type_name:hj_name,share_type:s,share_ids:share_ids,checkboxids:checkboxids,release_status:release_status,media_type:param_appType_id>0?param_appType_id:$("#radio_apptype_div input:checked").val(),scheme_id:param_scheme_id>0?param_scheme_id:scheme_id,structure_ids:param_structure_id>0?param_structure_id:getStrucValue().struc_id,subject_id:$("#sel_subject").val(),addResCode:a,icomet_url:"http://127.0.0.1/dsideal_yy/icometCommon/push"},cookieJson:{person_name:t,identity_id:i,person_id:e,token:p},upload:_action_path+url_path_action_login+"/yx/resource/uploadCallback",secTranster:_action_path+url_path_action_login+"/resource/getFileIdByMD5?resource_md5="};1==pt_type?(r.ossCloudOrSftp=!0,r.ossInfoUrl=_action_path+url_path_action_login+"/uploadres/getOssInfo",r.ossServer=url_path_down):2==pt_type&&(r.ossCloudOrSftp=!1,r.confirmUploadInfo=_action_path+url_path_action_login+"/uploadres/uploadFileFtp",r.sftpInfoUrl=_action_path+url_path_action_login+"/uploadres/uploadFileFtp");var _=Base64.encode(JSON.stringify(r));try{window.location.href="dsud://"+_}catch(n){n.returnValue=!1,$.cookie("new_reload","1",{path:"/"}),window.location.reload()}}function initEvent(){$(document).on("change","#sel_stage",function(){changeScheme()}),$(document).on("change","#sel_subject",function(){changeScheme()}),$(document).on("change","#scheme_id",function(){scheme_id=$(this).val(),changeStructure()})}function checkFileExtension(e){return e=e.toLowerCase(),1==file_type?"wmv"==e||"asf"==e||"flv"==e||"mp4"==e||"rmvb"==e?1:0:2==file_type?"txt"==e||"doc"==e||"docx"==e||"xls"==e||"xlsx"==e||"ppt"==e||"pptx"==e?1:0:3==file_type?"jpg"==e||"gif"==e||"png"==e||"jpeg"==e?1:0:4==file_type?"doc"==e||"docx"==e||"ppt"==e||"pptx"==e?1:0:5==file_type?"doc"==e||"docx"==e||"txt"==e||"xls"==e||"xlsx"==e||"ppt"==e||"pptx"==e||"swf"==e||"mid"==e||"wav"==e||"mp3"==e||"zip"==e||"rar"==e||"jpg"==e||"gif"==e||"png"==e||"bmp"==e||"jpeg"==e||"exe"==e?1:0:"doc"==e||"docx"==e||"txt"==e||"xls"==e||"xlsx"==e||"ppt"==e||"pptx"==e||"swf"==e||"mid"==e||"wav"==e||"mp3"==e||"zip"==e||"rar"==e||"jpg"==e||"gif"==e||"png"==e||"bmp"==e||"jpeg"==e||"exe"==e||"wmv"==e||"asf"==e||"flv"==e||"mp4"==e||"avi"==e||"rmvb"==e?1:0}function uploadFileInfo(file,upload_file_id){var file_name=file.name,file_size=file.size,file_size_str="";file_size<1e3?file_size_str=file_size+" B":file_size>=1e3&&file_size<1e6?file_size_str=(file_size/1e3).toFixed(2)+" KB":file_size>=1e6&&file_size<1e9?file_size_str=file_size/1e6+" MB":file_size>=1e9&&(file_size_str=file_size/1e9+" GB");var j=file_name.lastIndexOf("."),extension=file_name.substring(j+1);extension=extension.toLowerCase(),file_name=file_name.substring(0,file_name.lastIndexOf(".")),art.dialog({content:"正在保存资源信息...",width:240,title:"提示",close:function(){return!0},init:function(){dialog_save=this}});var m3u8_status=0;"wmv"!=extension&&"mp4"!=extension&&"avi"!=extension&&"flv"!=extension||(m3u8_status=1),null!=share&&(share_ids=share.sharerange("getRangeSel",1),checkboxids=share.sharerange("getRangeSel",2));var share_type=0;return""!=share_ids&&(share_type=1),$.ajax({type:"POST",async:!1,dataType:"json",data:{service_type:service_type,service_id:service_id,res_type:res_type,release_status:release_status,file_name:file_name,extension:extension,bk_type:hj_id,bk_type_name:hj_name,share_type:share_type,share_ids:share_ids,checkboxids:checkboxids,file_id:upload_file_id,resource_size:file_size_str,resource_size_int:file_size,m3u8_status:m3u8_status,media_type:param_appType_id>0?param_appType_id:$("#radio_apptype_div input:checked").val(),person_id:$.cookie("person_id"),scheme_id:param_scheme_id>0?param_scheme_id:scheme_id,structure_ids:param_structure_id>0?param_structure_id:getStrucValue().struc_id,subject_id:$("#sel_subject").val(),tempGuid:upload_file_id},url:url_path_html+"/yx/resource/uploadResource?random_num="+creatRandomNum(),success:function(data){data.success&&(setUploadCount(file_size,extension,1),setTimeout(function(){if(dialog_save.close(),null!=callBack){var str="parent."+callBack+"()";eval(str)}},3e3))}}),!0}function setUploadCount(e,t,i){var p=param_stage_id>0?param_stage_id:$("#sel_stage").val(),a=param_subject_id>0?param_subject_id:$("#sel_subject").val(),s=t;3!=i&&(s=(s=patchExtention(t)).substring(0,1));$.ajax({type:"GET",async:!1,dataType:"json",url:url_path_action+"/tongji/tj_upload?stage_id="+p+"&subject_id="+a+"&size="+e+"&type_id="+i+"&mtype="+s+"&random_num="+creatRandomNum()+"&wrids="+-1,success:function(e){}})}function patchExtention(e){e=e.toLowerCase();var t=getMap();t.put("jpg","2:图片"),t.put("png","2:图片"),t.put("jpeg","2:图片"),t.put("gif","2:图片"),t.put("bmp","2:图片"),t.put("eps","2:图片"),t.put("jpeg","2:图片"),t.put("jpe","2:图片"),t.put("pcx","2:图片"),t.put("raw","2:图片"),t.put("pict","2:图片"),t.put("pxr","2:图片"),t.put("sct","2:图片"),t.put("tiff","2:图片"),t.put("targa","2:图片"),t.put("psd","2:图片"),t.put("doc","3:文档"),t.put("docx","3:文档"),t.put("txt","3:文档"),t.put("xls","3:文档"),t.put("xlsx","3:文档"),t.put("ppt","3:文档"),t.put("pptx","3:文档"),t.put("pdf","3:文档"),t.put("docm","3:文档"),t.put("dotm","3:文档"),t.put("dotx","3:文档"),t.put("dot","3:文档"),t.put("xps","3:文档"),t.put("mht","3:文档"),t.put("nhtml","3:文档"),t.put("htm","3:文档"),t.put("html","3:文档"),t.put("rtf","3:文档"),t.put("xml","3:文档"),t.put("odt","3:文档"),t.put("wtf","3:文档"),t.put("xlsm","3:文档"),t.put("xlsb","3:文档"),t.put("xltx","3:文档"),t.put("prn","3:文档"),t.put("dif","3:文档"),t.put("slk","3:文档"),t.put("xlam","3:文档"),t.put("xps","3:文档"),t.put("ods","3:文档"),t.put("pptm","3:文档"),t.put("ppa","3:文档"),t.put("odp","3:文档"),t.put("pps","3:文档"),t.put("mp4","4:视频"),t.put("mpeg","4:视频"),t.put("mpg","4:视频"),t.put("3gp","4:视频"),t.put("flv","4:视频"),t.put("mkv","4:视频"),t.put("wmv","4:视频"),t.put("saf","4:视频"),t.put("avi","4:视频"),t.put("rm","4:视频"),t.put("flash","4:视频"),t.put("mid","4:视频"),t.put("swf","4:视频"),t.put("rmvb","4:视频"),t.put("asf","4:视频"),t.put("mov","4:视频"),t.put("mp3","5:音乐"),t.put("wma","5:音乐"),t.put("wav","5:音乐"),t.put("mod","5:音乐"),t.put("ra","5:音乐"),t.put("ram","5:音乐"),t.put("cd","5:音乐"),t.put("md","5:音乐"),t.put("ogg","5:音乐"),t.put("ape","5:音乐"),t.put("flac","5:音乐"),t.put("undefined","6:其他");var i=t.get(e);return i==undefined&&(i=t.get("undefined")),i}function getMap(){var e=new Object;return e.put=function(t,i){e[t+"_"]=i},e.get=function(t){return e[t+"_"]},e.remove=function(t){delete e[t+"_"]},e.keyset=function(){var t="";for(var i in e)"string"==typeof i&&"_"==i.substring(i.length-1)&&(t+=",",t+=i.substring(0,i.length-1));return""==t?t.split(","):t.substring(1).split(",")},e}var share=null,file_filter={disc:"*",content:"doc,docx,txt,xls,xlsx,ppt,pptx,swf,mid,wav,mp3,zip,rar,jpg,gif,png,jpeg,exe,wmv,avi,flv,mp4,asf,rmvb"},dialog_save,callBack,team_id=0,service_type=0,service_id=0,hj_id=0,hj_name="无",share_ids="",checkboxids="",release_status=1,file_type=0,param_stage_id=0,param_subject_id=0,param_scheme_id=0,param_structure_id=0,param_appType_id=0,res_type=1,file_num=10;$(function(){if(null!=$.cookie("person_id"))if(null!=GetQueryString("service_type")&&(service_type=GetQueryString("service_type"),null!=GetQueryString("service_id")&&(service_id=GetQueryString("service_id")),null!=GetQueryString("hj_id")&&(hj_id=GetQueryString("hj_id")),null!=GetQueryString("hj_name")&&(hj_name=GetQueryString("hj_name"))),null!=GetQueryString("file_num")&&(file_num=GetQueryString("file_num")),null!=GetQueryString("res_type")&&(res_type=GetQueryString("res_type")),null!=GetQueryString("callBack")&&(callBack=GetQueryString("callBack")),null!=GetQueryString("file_type")&&(file_type=GetQueryString("file_type")),1==file_type?($("#file_type").html("文件类型：wmv,asf,flv,mp4,rmvb"),file_filter={disc:"*",content:"wmv,avi,flv,mp4,asf,rmvb"}):2==file_type?($("#file_type").html("文件类型：doc,docx,txt,xls,xlsx,ppt,pptx"),file_filter={disc:"*",content:"doc,docx,txt,xls,xlsx,ppt,pptx"}):3==file_type?($("#file_type").html("文件类型：jpg,gif,png,jpeg"),file_filter={disc:"*",content:"jpg,gif,png,jpeg"}):4==file_type?($("#file_type").html("文件类型：doc,docx,ppt,pptx"),file_filter={disc:"*",content:"doc,docx,ppt,pptx"}):5==file_type&&($("#file_type").html("文件类型：doc,docx,txt,xls,xlsx,ppt,pptx,swf,mid,wav,mp3,zip,rar,jpg,gif,png,bmp,jpeg,exe"),file_filter={disc:"*",content:"doc,docx,txt,xls,xlsx,ppt,pptx,swf,mid,wav,mp3,zip,rar,jpg,gif,png,bmp,jpeg,exe"}),null!=GetQueryString("team_id")&&(team_id=GetQueryString("team_id")),null!=GetQueryString("release_status")&&(release_status=GetQueryString("release_status")),team_id>0?(share_ids=team_id,checkboxids="share_self,"+team_id):service_type>0&&service_id>0||(share=$("#myshare").sharerange()),plupload(file_num,-1,"200mb"),$(".plupload_header_text").html("（ 提示：如尚未安装文件传输助手，<a onclick='downExe()' style='text-decoration:underline;color:red'>点此下载</a>）"),param_scheme_id=null==GetQueryString("scheme_id")?0:GetQueryString("scheme_id"),param_structure_id=null==GetQueryString("structure_id")?0:GetQueryString("structure_id"),param_scheme_id>0&&param_structure_id>0)$("#sel_stage_subject").parent().hide(),param_appType_id=null==GetQueryString("appType_id")?2:GetQueryString("appType_id");else{var e=$.cookie("background_stage_id"),t=$.cookie("background_subject_id");param_stage_id=null==GetQueryString("stage_id")?0:GetQueryString("stage_id"),param_subject_id=null==GetQueryString("subject_id")?0:GetQueryString("subject_id"),param_stage_id>0&&param_subject_id>0&&(e=param_stage_id,t=param_subject_id),xd_subject_type=1,initSelectStageSubject(e,t),initStructure(),changeScheme(),initAppType(),initEvent()}});