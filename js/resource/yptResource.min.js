function showVideoInfo(e,t){tb_show("当前视频："+e,t+"&TB_iframe=true&height=520&width=820","thickbox")}function showResourceInfo(e,t){var n="";n=t.indexOf("?")>0?"&":"?",tb_show("当前资源："+e,t+n+"TB_iframe=true&height=520&width=820","thickbox")}function showResourceById(e,t){var n=url_path_html+"/yx/html/showYptNsResource.html?id="+t+"&t="+Math.random();art.dialog.open(n,{title:e,height:550,width:850,zIndex:9999,lock:!0})}function openResourcePage(e){window.open(url_path_html+"/yx/html/showResource.html?u="+e)}function render_resourcePage(e,t){if(null!=e.list&&e.list.length>0){upDataToJson(e=addServerUrlToJson(e),1),beforeRender(e);for(var n=$.cookie("person_id"),i=0;i<e.list.length;i++)e.list[i].person_id==n?e.list[i].is_mine=!0:e.list[i].is_mine=!1;undefined!=$.cookie("person_id")&&"null"!=$.cookie("person_id")?e.isLogin=!0:e.isLogin=!1}var s=template.render(t+"Page_template",e);$("#"+t+"Page_content").html(s)}function showResOperation(e){$("#resBtn_"+e).css("display","block"),$("#m_"+e).mouseover(function(){$(this).show()}).mouseout(function(){$("#resBtn_"+e).hide(),$(this).hide()})}function hideResOperation(e){$("#addResBag_"+e).css("display","none"),$("#resBtn_"+e).css("display","none"),$("#addResZy_"+e).css("display","none")}function toChangeResource(e,t,n,i,s,o,c){$.ajax({type:"GET",async:!1,url:url_path_action+"/multiCheck/canRenameObj?obj_type=1&obj_id_int="+t,dataType:"json",success:function(c){c.success&&(1==c.can_rename?tb_show("标题："+e,url_path_html+"/yx/html/resource/res_edit.html?resource_title="+Base64.encode(e)+"&obj_id_int="+t+"&app_type_id="+n+"&subject_id="+i+"&scheme_id="+s+"&structure_code="+o+"&TB_iframe=true&height=510&width=420","thickbox"):dialogOk("正在审核或者审核通过，不可以修改。",360,""))}})}function toChangeResourceName(e,t,n){var i=url_path_html+"/yx/html/resource/changeResourceName.html?resource_id_int="+e+"&resource_title="+Base64.encode(t);art.dialog.open(i,{id:"toChangeResourceName",lock:!0,title:"修改资源名称",width:400,height:150,ok:function(){if(this.iframe.contentWindow.changeResourceName(e)&&(dialogClose("修改成功!",3,200),undefined!=n))new Function(n)()}})}function resourceDel(e,t,n){art.dialog.confirm("确定要删除吗？",function(){$.ajax({type:"POST",async:!1,dataType:"json",url:url_path_html+"/ypt/group/deleteResource",data:{resInfoId:e,resIdInt:t,deleteType:1},success:function(e){if(dialogClose("删除成功!",3,200),undefined!=n)new Function(n)()}})})}function delMyResource(e,t){art.dialog.confirm("确定要删除吗？",function(){$.ajax({type:"POST",async:!0,dataType:"json",url:url_path_html+"/yx/resource/delMyResource",data:{resIdInt:e},success:function(e){if(dialogClose("删除成功!",3,200),undefined!=t)new Function(t)()}})})}function delServiceResource(e,t){art.dialog.confirm("你确定要删除吗？",function(){$.ajax({async:!0,url:url_path_html+"/yx/resource/delServiceResource?math="+Math.random(),type:"post",data:{ids:e},dataType:"json",success:function(e){e.success?(dialogClose("删除成功！",3,200),setTimeout(function(){if(undefined!=t)new Function(t)()},3e3)):dialogClose("删除失败,请稍后再试！",3,200)}})})}function delServiceResourceByIdInt(e,t,n,i){art.dialog.confirm("你确定要删除吗？",function(){$.ajax({async:!0,url:url_path_html+"/yx/resource/delServiceResourceByIdInt?math="+Math.random(),type:"post",data:{ids:e,service_type:t,service_id:n},dataType:"json",success:function(e){e.success?(dialogClose("删除成功！",3,200),setTimeout(function(){if(undefined!=i)new Function(i)()},3e3)):dialogClose("删除失败,请稍后再试！",3,200)}})})}function addServiceResource(e,t,n,i,s){art.dialog.confirm("你确定要执行审核操作吗？",function(){$.ajax({async:!0,url:url_path_html+"/yx/resource/addServiceResource?math="+Math.random(),type:"post",data:{ids:e,service_type:t,service_id:n,bk_type:i},dataType:"json",success:function(e){e.success?(dialogClose("审核成功！",3,200),setTimeout(function(){if(undefined!=s)new Function(s)()},3e3)):dialogClose("审核失败,请稍后再试！",3,200)}})})}function dropdownShow(e){var t=$("#"+e).offset().top+$("#"+e).height(),n=$("#business_content").offset().top+$("#business_content").height()-t-20,i=$(".r-menu").height();0==i&&(i=116),n<i?($("#"+e).next().removeClass("dropdown-menu"),$("#"+e).next().addClass("dropup-menu")):($("#"+e).next().removeClass("dropup-menu"),$("#"+e).next().addClass("dropdown-menu")),$(".dropdown-menu r-menu").css("display","none");var s=e.substring(4);"none"==$("#m_"+s).css("display")?$("#m_"+s).css("display","block"):$("#m_"+s).css("display","none")}function upDataToJson(e,t){var n=STATIC_IMAGE_PRE+"down/Material/",i=url_path_down+"down/Thumbs/",s=self.parent.g_is_teacher;e.is_teacher=s;var o=self.parent.g_is_qyjh;e.is_qyjh=o,9==$("#view_id_hid").val()?e.show_qyjh=1:e.show_qyjh=0;new Array;$.each(e.list,function(s,o){var c=o.resource_format,r=o.file_id;undefined==o.url_code&&(o.url_code=encodeURI(o.resource_title));r.substring(0,2),o.url_code;var a="",d=o.resource_title+"."+c,l="",u=o.thumb_id,h=i+u.substring(0,2)+"/"+u+".thumb",_=o.resource_page,p={file_ext:c,file_id:r,file_title:o.resource_title,file_page:_,_width:o.width,_height:o.height,p_status:o.preview_status,p_type:1},f=dealPreviewFun(p);a=f._class,l=f._href,d=f._title;var m={file_id:r,file_ext:c,for_urlencoder_url:o.for_urlencoder_url,for_iso_url:o.for_iso_url,url_code:o.url_code},y=dealDownpathFun(m),b="filename="+o.resource_title+"."+c+",url="+n+r.substring(0,2)+"/"+r+"."+c,g="dsoneres://"+Base64.encode(b);if(e.list[s].down_path=y,e.list[s].khd_down_path=g,2==t){var w="";1==o.type_id?w="我的收藏":2==o.type_id?w="我推荐的资源":3==o.type_id?w="推荐给我的资源":4==o.type_id?w="我的评论":5==o.type_id?w="我的反馈":6==o.type_id?w="我的上传":7==o.type_id&&(w="我的共享"),e.list[s].myres_source=w}else{var k=$("#view_id_hid").val();e.range_type=k}e.list[s].app_type_title=e.list[s].app_type_name;var v=e.list[s].app_type_name.split(",");v.length>1&&(e.list[s].app_type_name=v[0]+"..."),e.list[s].class_b=a,e.list[s].class_a="text-overflow "+a,e.list[s].title=d,e.list[s].href=l,e.list[s].href_a=l,e.list[s].data_original=h})}function setViewCount(){$.ajax({type:"GET",async:!1,dataType:"json",url:url_path_html+"/tongji/tj_view?type_id=1&random_num="+creatRandomNum(),success:function(e){}})}function changeDownloadNum(e,t,n){stopBubble(n),$.ajax({type:"GET",async:!1,dataType:"json",url:url_path_html+"/ypt/resource/setDownCount?resource_id_int="+t+"&random_num="+creatRandomNum(),success:function(e){e.success||dealReturnMsg(e)}}),setDownloadCount()}function setDownloadCount(){$.ajax({type:"GET",async:!1,dataType:"json",url:url_path_html+"/tongji/tj_down?type_id=1&random_num="+creatRandomNum(),success:function(e){}})}function getCheckBoxObj(e){return g_CheckBox==undefined&&(g_CheckBox=new CheckBox),e!=undefined&&1==e&&g_CheckBox.reInit(),g_CheckBox}function getBatchOperObj(){return g_BatchOper==undefined&&(g_BatchOper=new BatchOper),g_BatchOper}function BatchOper(){this.dom_operSpan=$("#span_batch"),this.isBatchOper=!1,this.operMode="del",this.reInit=function(){this.dom_operSpan=$("#span_batch"),this.isBatchOper=!0,this.operMode="del"},this.toggleToolbar=function(){var e=getCheckBoxObj();this.isBatchOper?(e.hideAll(),this.dom_operSpan.hide()):(e.showAll(),$("input[name='radio_model'][value='"+this.operMode+"']").attr("checked","checked"),this.setOperMode(this.operMode),this.dom_operSpan.show()),this.isBatchOper=!this.isBatchOper},this.setOperMode=function(e){var t=getCheckBoxObj();null==e&&e==undefined||(this.operMode=e),t.clearAll(),t.showAll(),"del"==this.operMode&&(t.disabledByDel(),this.showBatDelBtn()),"chk"==this.operMode&&(t.disabledByCheck(),this.showBatCheckBtn())},this.showBatDelBtn=function(){$("#btn_batch_del").css("display","inline-block"),$("#btn_batch_check").css("display","none")},this.showBatCheckBtn=function(){$("#btn_batch_del").css("display","none"),$("#btn_batch_check").css("display","inline-block")}}function changeScheme(e){var t=url_path_html+"/resource/getAllScheme?random_num="+Math.random();$.ajax({type:"GET",async:!1,dataType:"json",url:t,data:{subject_id:$("#sel_subject").val(),type_id:1,plat_id:1,version_id:1,zj_zs:1},success:function(t){if(t.success){var n=template.render("select_xb",t);$("#select_xb_div").html(n),null!=e?(scheme_id=e,$("#scheme_id").val(scheme_id)):t.version_list.length>0&&(scheme_id=t.version_list[0].version_id),changeStructure()}else $("#scheme_id").html('<option value="0">请选择学科</option>'),scheme_id=0,struc.dropDownStruc("clearInput")}})}function initStructure(e){struc=$("#structure_div").dropDownStruc({type:2,width:170,init_struc_code:null==e?"":e,onStrucCheck:function(){}})}function changeStructure(){$("#select_struc_div").show(),struc.dropDownStruc("loadTree",$("#scheme_id").val())}function getStrucValue(){return struc.dropDownStruc("getValue")}function initMediaType(){$.ajax({type:"GET",async:!1,dataType:"json",url:url_path_action+"/media/getMediaType?type_id=0&random_num="+creatRandomNum(),success:function(e){if(e.success){var t=template.render("media_type_script",e);document.getElementById("media_type_content").innerHTML=t}}})}function initAppType(){$.ajax({type:"GET",async:!1,dataType:"json",data:{scheme_id:scheme_id,random_num:creatRandomNum()},url:url_path_action+"/apptype/get_apptype",success:function(e){if(e.success){var t=template.render("app_type_script",e);document.getElementById("app_type_content").innerHTML=t}}})}function CheckBox(){this.cbox_checkAll=$("#check_all"),this.cbox_children=$(".chks"),this.reInit=function(){this.cbox_checkAll=$("#check_all"),this.cbox_children=$(".chks")},this.showAll=function(){this.cbox_checkAll.css("display","inline-block"),this.cbox_checkAll.attr("checked",!1),this.cbox_children.css("display","inline-block")},this.hideAll=function(){this.cbox_checkAll.css("display","none"),this.cbox_checkAll.attr("checked",!1),this.cbox_children.css("display","none")},this.checkAll=function(){this.cbox_checkAll.attr("checked")?$(".chks:enabled").attr("checked",!0):this.cbox_children.attr("checked",!1)},this.clearAll=function(){this.cbox_checkAll.attr("checked",!1),this.cbox_children.attr("checked",!1)},this.disabledByDel=function(){$("input[canDel=false]").attr("disabled","disabled"),$("input[canDel=true]").removeAttr("disabled")},this.disabledByCheck=function(){$("input[canCheck=false]").attr("disabled","disabled"),$("input[canCheck=true]").removeAttr("disabled")}}function event_selBatMode(e){getBatchOperObj().setOperMode(e)}function event_toggleBatchModel(){getBatchOperObj().toggleToolbar()}function checkAll(){getCheckBoxObj().checkAll()}function openShareWin(e,t,n,i,s,o){void 0!==o&&(o.cancelBubble=!0),e=e.replace("‘","'"),tb_show(e,url_path_html+"/yx/html/resource/share.html?target_id="+t+"&target_type=1&s_type=1&r_type="+s+"&TB_iframe=true&height=400&width=300","thickbox")}function showCheckPage(e,t,n){tb_show("当前审核资源："+t,url_path_html+"/yx/html/resource/res_check.html?type="+n+"&check_id="+e+"&unit_id="+unit_id+"&TB_iframe=true&height=300&width=560","thickbox")}function showModifyCheckPage(e,t,n,i){tb_show("修改审核结果："+n,url_path_html+"/yx/html/resource/res_check_modify.html?unit_id="+unit_id+"&check_id="+t+"&check_status="+e+"&TB_iframe=true&height=280&width=560","thickbox")}function showSupersedeCheckPage(e,t,n){tb_show("【代审】当前审核资源："+t,url_path_html+"/yx/html/resource/res_supersede_check.html?type="+n+"&check_id="+e+"&unit_id="+unit_id+"&TB_iframe=true&height=300&width=560","thickbox")}function ajax_delCheckInfo(e){var t={check_ids:e};$.ajax({async:!1,type:"POST",url:url_path_html+"/ypt/multiCheck/delCheckInfo?random_num="+creatRandomNum(),data:{param_json:JSON.stringify(t)},dataType:"json",success:function(e){e.success?dialogClose("删除成功",2,200,"toPage(1);"):"notlogin"==e.info?top.location="/admin":alert(e.info)}})}function delRes(e){dialogOkCancel("确定删除当前资源吗？",200,"delResFun("+e+")","")}function delResFun(e){ajax_delCheckInfo([e])}function subResCheck(){for(var e=document.getElementsByName("res_check"),t=new Array,n=0,i=0;i<e.length;i++)e[i].checked&&(t.push({id:e[i].id,n:e[i].value}),n++);if(0==n)return void self.parent.parent.dialogOk("请选择要审核的资源。",250,"");var s=JSON.stringify(t);s=Base64.encode(s),tb_show("资源审核",url_path_html+"/yx/html/resource/res_check.html?type=1&reslist="+s+"&unit_id="+unit_id+"&TB_iframe=true&height=400&width=560","thickbox")}function event_batchDel(){if(0==$(".chks:checked").length)return void dialogOk("请在表格中选择要删除的记录",300);dialogOkCancel("确定批量删除已经选中的资源吗？",350,"batchDelObj()","")}function batchDelObj(){var e=$(".chks:checked"),t=[];$.each(e,function(e,n){t.push(n.id)}),ajax_delCheckInfo(t)}function SensitiveWord(){this.idArray=new Array,this.idArrayStr="",this.getIdStr=function(){this.idArrayStr=this.idArray.join()},this.resHash={},this.wordHash,this.init=function(){return},this.hasWord=function(e){return this.wordHash!=undefined&&this.wordHash[e]!=undefined},this.getWord=function(e){return this.hasWord(e)?this.wordHash[e]:undefined},this.viewWord=function(e){var t=this.resHash[parseInt(e)],n=t.resource_title+"."+t.resource_format,i=this.getWord(parseInt(e)),s=JSON.stringify(i);top.tb_show("查看敏感词",url_path_html+"/html/base/resource_check/show_sensitive_word.html?resource_title="+escape(n)+"&word_detail="+escape(s)+"&TB_iframe=true&height=320&width=560","thickbox")}}function getInfoAndCheckFlow(e,t,n,i,s){void 0!==s&&stopBubble(s),tb_show("当前资源:"+e,url_path_html+"/yx/html/resource/show_res_info.html?resource_type="+t+"&type_id="+n+"&resource_id="+i+"&TB_iframe=true&height=360&width=540","thickbox")}function getRecordButton(e,t,n){var i=new Object;return i.btn_recommend=!1,i.btn_cancel_recommend=!1,i.btn_toTop=!1,i.btn_cancel_toTop=!1,i.btn_check=!1,i.btn_modify=!1,i.btn_delete=!1,i.btn_supersedeCheck=!1,null!=n&&n!=undefined||(n=!0),n?"10"==e.current_status?(1==e.can_supersedeCheck?i.btn_supersedeCheck=!0:i.btn_check=!0,1==e.can_delete&&(i.btn_delete=!0)):"11"==e.current_status?null!=e.sort_ts&&e.sort_ts!=undefined?(1==e.b_top?i.btn_cancel_toTop=!0:i.btn_toTop=!0,i.btn_cancel_recommend=!0):(i.btn_recommend=!0,1==e.can_modify&&(i.btn_modify=!0),1==e.can_delete&&(i.btn_delete=!0)):"12"==e.current_status&&(1==e.can_delete&&(i.btn_delete=!0),1==e.can_modify&&(i.btn_modify=!0)):"10"==e.current_status?(1==e.can_supersedeCheck?i.btn_supersedeCheck=!0:i.btn_check=!0,1==e.can_delete&&(i.btn_delete=!0)):"11"==e.current_status?(1==e.can_modify&&(i.btn_modify=!0),1==e.can_delete&&(i.btn_delete=!0)):"12"==e.current_status&&(1==e.can_delete&&(i.btn_delete=!0),1==e.can_modify&&(i.btn_modify=!0)),i}function dealData(e){sensitiveWord=new SensitiveWord,$.each(e.list,function(t,n){sensitiveWord.idArray.push(n.obj_id_int);var i={resource_title:n.resource_title,resource_format:n.resource_format};sensitiveWord.resHash[parseInt(n.obj_id_int)]=i;var s=n.resource_format,o=n.file_id,c="",r=n.resource_title+"."+s;""==s&&(r=n.resource_title);var a="",d=n.resource_page,l={file_ext:s,file_id:o,file_title:n.resource_title,file_page:d,_width:0,_height:0,p_status:n.preview_status,p_type:1},u=dealPreviewFun(l);c=u._class,a=u._href;var h={file_id:o,file_ext:s,for_urlencoder_url:n.for_urlencoder_url,for_iso_url:n.for_iso_url,url_code:n.url_code},_=dealDownpathFun(h);e.list[t].down_path=_,e.list[t]._class=c,e.list[t]._href=a,e.list[t].title=r,"-1"==e.list[t].resource_size&&(e.list[t].resource_size="--");e.list[t].dest_unit;e.list[t].dest=0}),sensitiveWord.init(),e.sensitiveWord=sensitiveWord}function changeDownloadNum(e){$.ajax({type:"GET",async:!1,dataType:"json",url:url_path_action+"/resource/setDownCount?resource_id_int="+e+"&random_num="+creatRandomNum(),success:function(e){}})}function changePreviewNum(e){$.ajax({type:"GET",async:!1,dataType:"json",url:url_path_html+"/yx/resource/setPreviewCount?id="+e+"&random_num="+creatRandomNum(),success:function(e){}})}function openReview(e,t){tb_show("当前备课资源："+e,url_path_html+"/html/ypt/review/review.html?target_id="+t+"&target_type=1&s_type=4&r_type=0&TB_iframe=true&height=500&width=640","thickbox")}var g_BatchOper,g_CheckBox,media_type_id=0,app_type_id=0,scheme_id=0,struc,structure_id=0,sensitiveWord;