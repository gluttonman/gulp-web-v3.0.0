function addScriptTag(o){var e=document.createElement("script");e.setAttribute("type","text/javascript"),e.src=o,document.body.appendChild(e)}function enterLogin(o){13==o.keyCode&&(o.returnValue=!1,o.cancel=!0,doLogin())}function doLogin(){0==sso_flag?doLoginLocal():doLoginSso()}function doLoginLocal(){var o=document.getElementById("user").value;if(""==(o=o.replace(/(^\s*)|(\s*$)/g,"")))return $("#log_error").text("请输入用户名！"),void $("#log_error").css("visibility","visible");var e=document.getElementById("pwd").value;if(""==(e=e.replace(/(^\s*)|(\s*$)/g,"")))return $("#log_error").text("请输入登录密码！"),void $("#log_error").css("visibility","visible");$.ajax({url:url_path_action_login+"/login/doLogin?random_num="+creatRandomNum()+"&login_type=1&sys_type=7",async:!1,type:"GET",data:$("#login_form").serialize(),dataType:"json",success:function(o){o.success?($.cookie("person_id",o.person_id,{path:"/"}),$.cookie("identity_id",o.identity,{path:"/"}),$.cookie("token",o.token,{path:"/"}),$.cookie("person_name",o.person_name,{path:"/"}),$.cookie("role_id",o.role_id,{path:"/"}),$.cookie("user",o.user,{path:"/"}),$.cookie("menu_value_cookie",1,{path:"/"}),$.cookie("res_yunormy",1,{path:"/"}),$.cookie("que_yunormy",1,{path:"/"}),$.cookie("juan_yunormy",1,{path:"/"}),$.cookie("bk_yunormy",1,{path:"/"}),$.cookie("wk_yunormy",1,{path:"/"}),$.cookie("group_id",0,{path:"/"}),$.cookie("STATIC_INDEX_NAME","云备课中心",{path:"/"}),window.location.reload()):($("#log_error").css("visibility","visible"),$("#log_error").html(o.info))}})}function doLoginSso(){var o=document.getElementById("user").value;if(""==(o=o.replace(/(^\s*)|(\s*$)/g,"")))return $("#log_error").text("请输入用户名！"),void $("#log_error").css("visibility","visible");var e=document.getElementById("pwd").value;if(""==(e=e.replace(/(^\s*)|(\s*$)/g,"")))return $("#log_error").text("请输入登录密码！"),void $("#log_error").css("visibility","visible");addScriptTag(ajaxLoginAddr+"?targetService="+getLoginInfoAddr+"&callback=loginFormState&userName="+o+"&password="+e)}function loginState(o){"true"==o.isLogin?$.ajax({type:"GET",url:getLoginInfoAddr+"?ticket="+o.ticket,async:!1,dataType:"json",success:function(o){loginAfterSso(2)},error:function(o){loginAfterSso(2)}}):($.removeCookie("person_id",{path:"/"}),$.removeCookie("identity_id",{path:"/"}))}function loginFormState(o){if("true"==o.isLogin)$.ajax({type:"GET",url:getLoginInfoAddr+"?ticket="+o.ticket,async:!1,dataType:"json",success:function(o){loginAfterSso(1)},error:function(o){loginAfterSso(1)}});else switch(o.errorCode){case"1":$("#log_error").text("用户名不存在！"),$("#log_error").css("visibility","visible");break;case"2":$("#log_error").text("用户名和密码不匹配！"),$("#log_error").css("visibility","visible");break;case"3":break;case"4":$("#log_error").text("票据已经失效,请重新登录！"),$("#log_error").css("visibility","visible");break;case"0":$("#log_error").text("服务器端票据错误！"),$("#log_error").css("visibility","visible")}}function loginAfterSso(o){$.ajax({url:url_path_action_login+"/caslogin/casLoginWithShare?random_num="+creatRandomNum()+"&login_type=1&sys_type=7",async:!1,type:"GET",dataType:"json",success:function(e){e.success?($.cookie("person_id",e.person_id,{path:"/"}),$.cookie("identity_id",e.identity,{path:"/"}),$.cookie("token",e.token,{path:"/"}),$.cookie("person_name",e.person_name,{path:"/"}),$.cookie("role_id",e.role_id,{path:"/"}),$.cookie("user",e.user,{path:"/"}),$.cookie("menu_value_cookie",1,{path:"/"}),$.cookie("res_yunormy",1,{path:"/"}),$.cookie("que_yunormy",1,{path:"/"}),$.cookie("juan_yunormy",1,{path:"/"}),$.cookie("bk_yunormy",1,{path:"/"}),$.cookie("wk_yunormy",1,{path:"/"}),$.cookie("group_id",0,{path:"/"}),$.cookie("STATIC_INDEX_NAME","云备课中心",{path:"/"}),1==o&&window.location.reload()):($("#log_error").css("visibility","visible"),$("#log_error").html(e.info))}})}function check(){var o=document.getElementById("user").value;if(""==(o=o.replace(/(^\s*)|(\s*$)/g,"")))return $("#log_error").text("请输入用户名！"),$("#log_error").css("visibility","visible"),!1;var e=document.getElementById("pwd").value;return""!=(e=e.replace(/(^\s*)|(\s*$)/g,""))||($("#log_error").text("请输入登录密码！"),$("#log_error").css("visibility","visible"),!1)}function doLogout(o){var e=url_path_html+"/login/doLogout?type=2&t="+Math.random();$.ajax({url:e,type:"get",async:!1,success:function(e){window.location=null!=o?o:"/dsideal_yy/yx/html/index.html"}})}$(function(){sso_flag});