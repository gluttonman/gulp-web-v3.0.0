function base64Encode(e){return Base64.decode(e)}function getGroupInfo(){var e={};(e=group_data).getGroupPhoto=getGroupPhoto,e.GROUP_ID=org_id,e.is_super=is_super,e.is_admin=is_admin,e.is_member=is_member,e.is_login=is_login,e.is_exist=is_exist;var o=template("group_info_inner",e);$("#group_info").html(o)}function getGroupInitInfo(){$.ajax({type:"GET",async:!1,data:{random_num:creatRandomNum(),groupId:org_id},url:url_path_action_login+"/group/queryGroupById",dataType:"json",success:function(e){if(0==e.success)return art.dialog.alert("指定ID的群组不存在"),!1;if($.cookie("person_id")&&e.CREATOR_ID==$.cookie("person_id")&&$.cookie("identity_id")&&e.IDENTITY_ID==$.cookie("identity_id"))is_admin=1,is_super=1;else for(var o=0;o<e.list_person.length;o++)$.cookie("person_id")&&e.list_person[o].person_id==$.cookie("person_id")&&$.cookie("identity_id")&&e.list_person[o].identity_id==$.cookie("identity_id")&&(is_admin=1);group_info_=e},error:function(){}}),$.cookie("person_id")&&(is_login=1,$.ajax({type:"GET",async:!1,data:{random_num:creatRandomNum(),person_id:$.cookie("person_id"),identity_id:$.cookie("identity_id"),group_id:org_id},url:url_path_action_login+"/group/isExist",dataType:"json",success:function(e){e.success?is_member=1:is_exist=e.STATE_ID}}))}function getGroupMembers(e){var o={};$.ajax({type:"GET",async:!1,data:{random_num:creatRandomNum(),groupId:org_id,nodeId:org_id,rangeType:3,orgType:-1,stage_id:-1,subject_id:-1,keyword:"",member_type:-1,pageNumber:e,pageSize:10},url:url_path_action_login+"/space/group/getMemberByparams",dataType:"json",success:function(e){e.success&&((o=e).GROUP_ID=org_id,o.is_super=is_super,o.is_admin=is_admin,o.is_member=is_member,o.is_login=is_login,$.cookie("person_id")&&(o.person_id=$.cookie("person_id"),o.identity_id=$.cookie("identity_id")),o.cheNum=group_data.IS_CHECK_COUNT,1==is_super?o.member_type=0:1==is_admin?o.member_type=1:o.member_type=2,o.getSpaceUserPhoto=getSpaceUserPhoto)},error:function(){}});var t=template("group_member_inner",o);$("#group_member").html(t),$("#manageTablePage").spacePage({pageSize:o.pageSize,pageNumber:o.pageNumber,totalPage:o.totalPage,totalRow:o.totalRow,callBack:getGroupMembers})}function getGroupPhoto(e,o){if(!e||e.indexOf("group/default.png")>0)return"../../../images/head_icon/group/default.png";var t=e.substring(0,2);return o||(o=""),STATIC_IMAGE_PRE+url_path_img+t+"/"+e+o}function applicationToGroup(e,o,t){var i;art.dialog({title:"请输入验证信息",content:"<div id='shenqingTextareDiv'></div>",width:300,height:150,lock:!0,resize:!1,fixed:!0,padding:"10px",init:function(){(i=$("#shenqingTextareDiv").textarea({index:3,width:"260",height:"100",word_length:50})).textarea("initContent","我是"+$.cookie("person_name"))},close:function(){getGroupInitInfo(),getGroupInfo()}},function(){var e=art.dialog({title:"提示",height:50,lock:!0,resize:!1,fixed:!0});if(0==i.textarea("value").length)return e.content("请输入验证信息").time(2),!1;$.ajax({type:"GET",async:!1,data:{random_num:creatRandomNum(),groupId:o,checkContent:i.textarea("value")},url:url_path_action+"/group/requestJoinGroup",dataType:"json",success:function(i){if(i.success){e.content("申请已发送，正在审核中").time(2);var n={business_type:116,relatived_id:o,operation_content:$.cookie("person_name")+"申请加入群组："+t+"。"};creditWriteToQueue(n)}else e.content("请求异常")},error:function(){e.content("请求异常")}})},function(){})}function createGroupDialog(e,o,t){var i={};1==e?(i.name=$("#group_info").find(".groupName").html(),i.url=t,i.desc=$("#group_info").find(".groupDesc").html(),i.getGroupPhoto=getGroupPhoto,i.stage_id=$("#group_info").find("#stage_id").val(),i.subject_id=$("#group_info").find("#subject_id").val()):(i.name="",i.url="../../../images/head_icon/group/default.png",i.desc="",i.getGroupPhoto=getGroupPhoto);var n,a,r=template("addGroupDialog",i);uploadDialog=art.dialog({title:0==e?"创建群组":"修改群组信息",content:r,width:450,lock:!0,resize:!1,fixed:!0,zIndex:1e3,padding:"20px 25px 0",init:function(){n=$("#addGroupNameInput").input({index:1,placeholder:"请输入群组名称",maxCount:30,showType:1,width:275,onCheck:function(){""==n.input("value")&&n.input("setTips","群组名不能为空")}}),a=$("#addGroupDescTextarea").textarea({index:3,width:"275px",height:"70px",word_length:300}),1==e&&(n.input("setVal",i.name),a.textarea("initContent",i.desc)),n.input("check")},close:function(){n.input("destroy"),a.textarea("destroy"),uploadDialog=null,getGroupInfo()}},function(){var t=n.input("value"),r=a.textarea("value");r=r.trim();var d=$("input[name='queryType']:checked").val();if((t=t.replace(/\s+$/gi,"")).length<=0)return art.dialog({title:"提示",content:"请输入群组名称",width:200,lock:!0,time:1.5,resize:!1,fixed:!0,cancel:!1}),!1;if(0==e){u=Base64.encode($("#avatar_url").val());$.ajax({url:url_path_action+"/group/saveGroup?random_num="+creatRandomNum(),async:!1,type:"POST",data:{group_name:t,group_desc:r,avater_url:u,parent_type:-1,parent_id:-1,group_type:d,use_range:1,plat_type:1,plat_id:0},dataType:"json",success:function(e){1==e.success?dialogClose(e.info,2,200,""):"notlogin"==e.info?top.location=url_path_action+"/":dialogClose(e.info,2,200,"getGroupInitInfo();loadSpaceCommon();getGroupInfo();")}})}else{var u=$("#avatar_url").val();$.ajax({url:url_path_action+"/group/updateGroup?random_num="+creatRandomNum(),async:!1,type:"POST",data:{group_name:t,group_desc:r,avater_url:u,id:o,stage_id:i.stage_id,subject_id:i.subject_id},dataType:"json",success:function(e){1==e.success?dialogClose(e.info,2,200,"getGroupInitInfo();getGroupInfo();"):"notlogin"==e.info?top.location=url_path_action+"/":dialogClose(e.info,2,200,"")}})}},function(){})}function selectAvatar(){tb_show("上传群组头像","../../../html/space/common/uploadGroup.html?type=1&TB_iframe=true&height=340&width=700","thickbox")}function tb_remove(){return $("#TB_imageOff").unbind("click"),$("#TB_closeWindowButton").unbind("click"),$("#TB_iframeContent").remove(),$("#TB_window,#TB_overlay,#TB_HideSelect").remove(),$("#TB_load").remove(),!1}function getSelectPersonByOrg(e,o){var t=$("#addGroupMemberDiv .btn_ul > li[class='active']").attr("selIdentityId"),i=0;i=$("#selMemberBySelf").attr("checked")&&0!=$("#selMemberBySelf").val()?$("#selMemberBySelf").val():defaultOrgId;var n={};$.ajax({type:"GET",async:!1,data:{random_num:creatRandomNum(),unit_id:i,identity_id:$.cookie("identity_id"),identity_ids:t,person_id:$.cookie("person_id"),searchTerm:Base64.encode(addGroupMembersKeyword.search("value")),pageNumber:e,pageSize:10,group_id:o},url:url_path_action_login+"/group/queryGroupPersonsByKeyAndOrg",dataType:"json",success:function(e){e.success?(n=e).groupId=o:n.rows=[]},error:function(){n.rows=[]}});var a=template("addGroupMemberTem",n);$("#addGroupMemberTable").html(a),$("#addGroupMemberCheckAll").click(function(){$(this).attr("checked")?($(".addGroupMemberCheckbox").attr("checked",!0),$(".addGroupMemberCheckbox[disabled]").attr("checked",!1)):$(".addGroupMemberCheckbox").attr("checked",!1)}),$("#addGroupMemberPage").spacePage({pageSize:10,pageNumber:n.page,totalPage:n.total,totalRow:n.records,callBack:function(e){getSelectPersonByOrg(e,o)}})}function addPersonToGroup(e,o,t){var i=[],n=1;if(0==o)i=[{person_id:$(t).closest("tr").find(".pid").val(),identity_id:$(t).closest("tr").find(".iid").val(),bureau_id:$(t).closest("tr").find(".orgid").val(),person_name:$(t).closest("tr").find(".name").html()}],n=$(t).closest("tr").find(".page_num").val();else if($(".addGroupMemberCheckbox:checked").each(function(){var e={person_id:$(this).closest("tr").find(".pid").val(),identity_id:$(this).closest("tr").find(".iid").val(),bureau_id:$(this).closest("tr").find(".orgid").val(),person_name:$(t).closest("tr").find(".name").html()};n=$(this).closest("tr").find(".page_num ").val(),i.push(e)}),0==i.length)return art.dialog({title:"提示",height:50,lock:!0,resize:!1,fixed:!0,content:"请选择要添加的人员",time:1}),!1;var a=!1;$.ajax({type:"GET",async:!1,data:{random_num:creatRandomNum(),groupId:e,pids:JSON.stringify(i)},url:url_path_action+"/group/addMember",dataType:"json",success:function(o){o.success?(a=!0,$(i).each(function(){var o={business_type:119,relatived_id:e,r_person_id:this.person_id,r_identity_id:this.identity_id,operation_content:$.cookie("person_name")+"邀请"+this.person_name+"进入群组："+org_info_.org_name+"。",e_relatived_id:""};creditWriteToQueue(o)})):a=!1},error:function(){a=!1}}),art.dialog({title:"提示",height:50,lock:!0,resize:!1,fixed:!0,content:a?"添加成功":"添加失败",time:1,close:function(){getSelectPersonByOrg(n,e)}})}function checkRequest(e,o){checkRequestDialog=art.dialog.open("../../../../html/space/common/request_check.html?id="+o+"&name="+name,{title:"成员审核",height:514,width:900,lock:!0,fixed:!0,close:function(){getGroupInitInfo(),getGroupInfo(),getGroupMembers(e)}})}function manageGroupMemberRemove(e,o,t,i,n,a,r,d,u,s){var c,p,l="确定将成员'"+i+"'移除群组吗？";0==e?(c=l,"移除成功，正在刷新人员列表",p=1):1==e&&1==t?(c="确定退出该群组吗？","退出成功，正在刷新",p=2):1==e&&2==t?(c=l,"移除成功，正在刷新人员列表",p=1):2==e&&(c="确定退出该群组吗？","退出成功，正在刷新",p=2),art.dialog.confirm(c,function(){$.ajax({url:url_path_action+"/group/quitGroup?random_num="+creatRandomNum(),method:"POST",async:!1,data:{memberId:o,memberType:t,groupId:r},dataType:"json",success:function(e,o,t){if(e.success)if(0==n&&a>1&&(a-=1),2==p){d={business_type:124,relatived_id:r,operation_content:$.cookie("person_name")+"退出群组"+name+"。",e_relatived_id:""};creditWriteToQueue(d),window.location.reload()}else{var d={business_type:120,relatived_id:r,r_person_id:u,r_identity_id:s,operation_content:$.cookie("person_name")+"将"+i+"移除群组"+name+"。",e_relatived_id:""};creditWriteToQueue(d),getGroupInitInfo(),getGroupInfo(),getGroupMembers(a)}else"notlogin"==e.info?top.location=url_path_action+"/":dialogOk(e.info,300,"")}})},function(){})}function setManageAdmin(e,o,t,i,n,a,r,d){var u="确定设置成员'"+e+"'为"+(1==t?"群管理员":"普通成员")+"吗？";art.dialog.confirm(u,function(){$.ajax({url:url_path_action+"/group/setMemberType?random_num="+creatRandomNum(),method:"POST",async:!1,data:{memberId:o,memberType:t},dataType:"json",success:function(e,o,t){1==e.success?(dialogClose("设置成功",1,200,""),getGroupMembers(i)):"notlogin"==e.info?top.location=url_path_action+"/":dialogOk(e.info,300,"")}})},function(){})}function addMember(){var e=url_path_html+"/yx/html/manage/team/add_mem.html?";e+="?callBack=activeResource_call_back",e+="&groupid=2",e+="&service_id="+org_id,e+="&TB_iframe=true",e+="&height=489",e+="&width=745",e+="$callback=",tb_show("添加小组成员",e,"thickbox"),$("#TB_iframeContent").css({width:"745px","margin-top":"0px","border-radius":"0px"}),$("#TB_title").css({"background-color":"#5bc0de","border-bottom":"1px solid #777",width:"745px"}),$("#TB_ajaxWindowTitle").css("color","#fff"),$("#TB_closeWindowButton").css({opacity:"1",color:"#fff"})}function goPage(){getGroupMembers(1)}window.onload=function(){getGroupInfo(),getGroupMembers(1)};var uploadDialog,addGroupMembersDialog=null,addGroupMembersKeyword,checkRequestDialog=null;