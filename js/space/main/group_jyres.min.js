function tb_remove(){return $("#TB_imageOff").unbind("click"),$("#TB_closeWindowButton").unbind("click"),$("#TB_window").fadeOut("fast",function(){$("#TB_iframeContent").remove(),$("#TB_window,#TB_overlay,#TB_HideSelect").trigger("unload").unbind().remove()}),$("#TB_load").remove(),document.onkeydown="",document.onkeyup="",refreshPage(1),!1}function refreshPage(e){getStatList(function(){getFolderList(function(){loadGroupResourceListTemplate(e)})})}function loadMainNav(){var e=template("mainGroupNavInner",{});$("#groupMain").html(e),$("#mainGroupNav a").click(function(e){e.preventDefault(),$(this).tab("show"),"#groupResource"==$(this).attr("href")?getMystatus=0:"#groupMyResource"==$(this).attr("href")&&(getMystatus=1),loadGroupResourceListTemplate(1)}),$("#mainGroupNav a:first").tab("show"),getSortHtml()}function getSortHtml(){var e={list:[],is_login:is_login,is_member:is_member,is_admin:is_admin},t=template("resourceSortInner",e);$("#groupResource").html(t);t=template("resourceTableTitalInner",e);$("#groupResourceListDiv").html(t),searchGroupInput=null,$("div[id $= 'search_input']").empty(),searchGroupInput=$("#search_input").search({btnclass:"btn btn-warning",tips:"请输入关键字",onsearch:function(){loadGroupResourceListTemplate(1)}}),$(".bannerLeft .resourceBtns > li > a").click(function(){$(this).parent().siblings().removeClass("active"),$(this).parent().addClass("active"),loadGroupResourceListTemplate(1)}),$("#groupResource").on("click","th[ressortth]",function(){var e=$(this);$(e).siblings("th[ressortth]").attr("reschecked","false"),$(e).attr("reschecked","true"),"glyphicon glyphicon-arrow-down"==$(e).find("i").attr("class")?$(e).find("i").attr("class","glyphicon glyphicon-arrow-up"):$(e).find("i").attr("class","glyphicon glyphicon-arrow-down"),loadGroupResourceListTemplate(1)})}function loadGroupResourceListTemplate(e){var t=searchGroupInput.search("value");t=t||"",t=Base64.encode(t);var i=$("th[ressortth][reschecked='true']").attr("ressortth"),o=2;o=$("th[ressortth][reschecked='true']").find("i").hasClass("glyphicon-arrow-up")?1:2;var r={},a={random_num:creatRandomNum(),res_type:1,keyword:t,pageSize:10,pageNumber:e,view:org_id,sort_type:i,beike_type:current_folder_id,sort_num:o};1==getMystatus&&(a.person_id=$.cookie("person_id")),$.ajax({type:"GET",async:!1,data:a,url:url_path_html+"/yx/resource/getServiceResourceList",dataType:"json",success:function(e){e.success?(my_resource_info_upDataToJson(e),(r=e).is_login=is_login,r.is_member=is_member,r.is_admin=is_admin):r={list:[]}},error:function(){r={list:[]}}}),setFolder(r);var s=template("resourceListInner",r);$("#groupResourceListTbody").html(s),$("#resourcePage").spacePage({pageSize:r.pageSize,pageNumber:r.pageNumber,totalPage:r.totalPage,totalRow:r.totalRow,callBack:loadGroupResourceListTemplate})}function removeMemberToFolder(e,t){beforeUploadResource(3,e,t)}function my_resource_info_upDataToJson(e){url_path_down,new Array;$.each(e.list,function(t,i){var o=i.resource_format,r=i.file_id,a="",s=i.resource_title+"."+o,l="",n=i.resource_page,d={file_ext:o,file_id:r,file_title:i.resource_title,file_page:n,_width:0,_height:0,p_status:i.preview_status,p_type:1},c=dealPreviewFun(d);a=c._class,l=c._href,1!=i.resource_type&&(l+="&ht=true");var u={file_id:r,file_ext:o,for_urlencoder_url:i.for_urlencoder_url,for_iso_url:i.for_iso_url,url_code:i.url_code},_=dealDownpathFun(u);e.list[t].down_path=_,""!=_&&(_=Base64.encode(_)),e.list[t].click_b_down="showDownload('"+i.iid+"',"+i.resource_id_int+",'"+i.resource_title+"','"+o+"','"+_+"','"+i.for_iso_url+"',1,0);";var p=i.thumb_id.substring(0,2);e.list[t].thumb_url=url_path_down+"down/Thumbs/"+p+"/"+i.thumb_id;var f=i.create_time;e.list[t].create_time=f.substring(0,10),e.list[t].class_b=a,e.list[t].title=s,e.list[t].href=l})}function removeMemberSubmit(e,t,i){if(!e)return void i(!1,"请选择要分组的资源");t||i(!1,"请选择分组"),$.ajax({type:"POST",url:url_path_html+"/yx/folder/removeResourceToFolder",data:{business_id:org_id,business_type:1,bk_type:t,res_info_id:e},dataType:"json",success:function(e){dialogClose("操作成功,正在刷新页面,请稍后...",3,300),setTimeout(function(){refreshPage(1)},3e3)}})}function beforeUploadResource(e,t,i){var o=template("category_member_inner",{FolderList:FolderList}),r=art.dialog({content:o,title:null==i?"请先选择分类":"修改"+i+"的分类",height:110,width:350,lock:!0,fixed:!0,close:function(){},button:[{name:"确定",callback:function(){var i=$("#category_memeber_select").val();1==e?addResource(i):removeMemberSubmit(t,i,function(e,t){e?r.close():dialogClose(t,2,150,"")})}},{name:"取消",callback:function(){}}]})}function getStatList(e){$.ajax({type:"POST",url:url_path_action_login+"/yx/stat/getServiceStat",data:{business_type:1,business_id:org_id,service_id:1},success:function(t){var i=template("resource_stat_inner",t.data);$("#resource_stat").html(i),e&&e()},error:function(){},dataType:"json"})}function getFolderList(e){$.ajax({type:"POST",async:!1,url:url_path_action_login+"/yx/folder/queryFolders",data:{business_type:1,person_id:org_id,identity_id:orgidentity_id,folder_type:3},success:function(t){FolderList=t,t.success&&showFolderListAtIndex(t.data,e)},error:function(){},dataType:"json"})}function setFolder(e){for(var t=0;t<e.list.length;t++){e.list[t].folderName="默认分类";for(var i=0;i<FolderList.data.length;i++)e.list[t].beike_type==FolderList.data[i].id&&(e.list[t].folderName=FolderList.data[i].folder_name)}}function showFolderListAtIndex(e,t){var i=template("forld_category_inner",{folders:e,current_folder_id:current_folder_id,is_member:is_member});$("#forld_category").html(i),$("#category_0").find("span").html("（"+$("#resourceTotal").html()+"）"),t&&t()}function folderCategoryManage(){getFolderCategory(),dia=art.dialog({content:$("#folderCategoryManageDialog").html(),width:480,lock:!0,icon:null,title:"分类管理",close:function(){showFolderListAtIndex(FolderList.data)}})}function getFolderCategory(){$("#folderCategoryManageDialog table tbody").empty();var e=template("folderCategoryManage_inner",{FolderList:FolderList});$("#folderCategoryManageDialog table tbody").html(e)}function editFolderManage(e,t,i){var o=null;art.dialog({title:0==e?"增加分类":"修改分类",content:"<div id='editSortDiv' style='width:400px;'><table width='100%' class='table table-info'><tbody><tr><td scope='row' width='72'>分类名称<br/>&nbsp;</td><td colspan='3'><div id='editSortTitle'></div></tr></tbody></table></div>",fixed:!0,lock:!0,width:400,init:function(){o=$("#editSortTitle").input({index:3,placeholder:"请输入分类名称",maxCount:20,showType:1,width:275,onCheck:function(){""==o.input("value")&&o.input("setTips","分类名称不能为空")}}),1==e&&o.input("setVal",$(t).closest("tr").find(".title").html()),$("#editSortTitle").val($.trim($("#editSortTitle").val()).substring(0,20)),$("#editSortHid").text(20-$("#editSortTitle").val().length),$("#editSortTitle").bind("keyup",function(){$("#editSortTitle").val($.trim($("#editSortTitle").val()).substring(0,20)),$("#editSortHid").text(20-$("#editSortTitle").val().length)}).bind("paste",function(){$("#editSortTitle").val($.trim($("#editSortTitle").val()).substring(0,20)),$("#editSortHid").text(20-$("#editSortTitle").val().length)})}},function(){var t=o.input("value");return 0==t.length?(art.dialog.alert("请输入分类名称！"),!1):t.length>20?(art.dialog.alert("分类名称过长！"),!1):void(0==e?$.ajax({type:"POST",async:!1,data:{person_id:org_id,identity_id:orgidentity_id,folder_name:t,business_type:1,is_private:0,folder_type:3},url:url_path_action_login+"/yx/folder/addFolder",dataType:"json",success:function(e){e.success?(FolderList.data.push({id:e.data,folder_name:t,pcount:0}),dialogClose("保存成功！",2,150,""),getFolderCategory(),dia.content($("#folderCategoryManageDialog").html())):dialogClose("保存失败！",2,150,"")},error:function(){dialogClose("保存失败！",2,150,"")}}):$.ajax({type:"POST",async:!1,data:{person_id:org_id,identity_id:orgidentity_id,folder_name:t,fid:i},url:url_path_action_login+"/yx/folder/editFolder",dataType:"json",success:function(e){if(e.success){for(var o=0;o<FolderList.data.length;o++)FolderList.data[o].id==i&&(FolderList.data[o].folder_name=t);dialogClose("修改成功！",2,150,""),getFolderCategory(),dia.content($("#folderCategoryManageDialog").html())}else dialogClose(e.info,2,150,"")},error:function(){dialogClose("修改失败！",2,150,"")}}))},function(){})}function delFolderManage(e,t){art.dialog({title:"删除分类",content:'确定删除"'+$(e).closest("tr").find(".title").html()+'"这个分类吗?',fixed:!0,lock:!0,icon:"question"},function(){$.ajax({type:"POST",async:!1,data:{fid:t,business_id:org_id,business_type:1,folder_type:3},url:url_path_action_login+"/yx/folder/deleteFolder",dataType:"json",success:function(e){if(e.success){for(var i=0;i<FolderList.data.length;i++)FolderList.data[i].id==t&&FolderList.data.splice(i,1);dialogClose("删除成功！",2,150,""),getFolderCategory(),dia.content($("#folderCategoryManageDialog").html()),setTimeout(function(){loadGroupResourceListTemplate(1)},3e3)}else art.dialog.alert("删除失败！"+e.info)},error:function(){art.dialog.alert("删除失败！"+data.info)}})},function(){})}function removeMemberSubmit(e,t,i,o){if(!e)return void o(!1,"请选择要分组的资源");t||o(!1,"请选择分组"),$.ajax({type:"POST",url:url_path_html+"/yx/folder/removeResourceToFolder",data:{business_id:org_id,business_type:1,bk_type:t,my_structure_id:i,res_info_id:e},dataType:"json",success:function(e){dialogClose("操作成功,正在刷新页面,请稍后...",3,300),setTimeout(function(){refreshPage(1)},3e3)}})}function categoryMembersByFolder(e){current_folder_id=e,$("#category_"+e).addClass("active").siblings().removeClass("active"),loadGroupResourceListTemplate(1)}function addResource(e){var t=url_path_html+"/yx/html/resource/uploadYxResource.html";t+="?service_type=1",t+="&service_id="+org_id,t+="&hj_id="+e,t+="&file_type=5",t+="&res_type=1",t+="&TB_iframe=true",t+="&height=450",t+="&width=720",tb_show("上传资源",t,"thickbox")}var searchGroupInput,tree_value=0,hide_flag=!0;window.onload=function(){loadMainNav(),refreshPage(1),$(".fancybox").fancybox({maxWidth:1200,afterShow:function(){$(".fancybox-next").css("right","-10px"),$(".fancybox-prev").css("left","-10px");var e=$(this);$(this.wrap).css("z-index","99").parent().css("z-index","98"),e[0].type;if($.cookie("person_id")&&$.cookie("identity_id")){var t=e[0].href;if(-1!=t.indexOf("paper_preview.html?paper_id")){$(".fancybox-next").css("right","15px"),$(".fancybox-prev").css("left","15px");var i='<div class="fancybox-title fancybox-title-outside-wrap-tool">',o="</div>",r=a=$(e[0].element).siblings(".down_path").html();$(i+r+o).appendTo(this.wrap)}else if(-1==t.indexOf("../../ypt/weike/wk_detail.html")&&-1==t.indexOf("/dsideal_yy/html/ypt/common/preview_flash2D.html")){e[0].title_a.split(".")[e[0].title_a.split(".").length-1].split("【")[0],t.split("file_id=")[1].substr(0,36),e[0].title_a.split("【")[0];var a=$(e[0].element).siblings(".down_path").html(),s=$(e[0].element).siblings(".review_path").html(),i='<div class="fancybox-title fancybox-title-outside-wrap-tool">',o="</div>";$(i+a+s+o).appendTo(this.wrap)}}}})};var getMystatus=0,current_folder_id=0,FolderList;