!function(t){window.myautodata={data:{},fillColume:"",focusIndex:-1,keyword:""};var a,e=null;t.widget("dui.autocomplete",{options:{inputclass:"form-control",inputwidth:260,maxinput:20,tips:"请输入（中文、简拼、全拼）进行检索",rows:5,url:"",columnData:null,afterSelHandler:null,inputVal:"",person_id:0},_create:function(){a=this,this.element.append("<div class='myautocomplete' style='display:inline-block;position:relative'></div>"),t(".myautocomplete").click(function(t){stopBubble(t)}),t(document).click(function(t){a._clearData()}),this.changer=t("<input>",{type:"text",id:"myautocompleteinput",placeholder:this.options.tips,"class":this.options.inputclass,width:this.options.inputwidth+"px",maxlength:this.options.maxinput}).appendTo(".myautocomplete"),this._on(this.changer,{keyup:this._onkeyup,paste:this._onpaste,blur:this._onblur}),this._isPlaceholer()||(t('<label id="replace_tip" style="position:absolute;left:13px;top:7px;color:grey">'+this.options.tips+"</label>").appendTo(".myautocomplete"),t("#replace_tip").bind("click",function(){t("#replace_tip").css("display","none"),t("#myautocompleteinput")[0].focus()}),t("#myautocompleteinput").bind("blur",function(){var a=t("#myautocompleteinput").val();""==t.trim(a)&&t("#replace_tip").css("display","block")}));var e="<div class='autocomplete' style='display:none;width:"+this.options.inputwidth+"px;position:absolute;background-color:#fff;z-index:9999'></div>";t(e).appendTo(".myautocomplete")},_onblur:function(a){t("#myautocompleteinput").val()!=this.options.inputVal&&(this.options.person_id=0)},_onkeyup:function(o){if(37!=o.keyCode&&38!=o.keyCode&&39!=o.keyCode&&40!=o.keyCode&&(myautodata.keyword!=t("#myautocompleteinput").val()&&(myautodata.focusIndex=-1),-1==myautodata.focusIndex&&myautodata.keyword!=t("#myautocompleteinput").val()&&(clearTimeout(e),e=setTimeout(function(){a._getData(1);var e=t("#myautocompleteinput").val();""==t.trim(e)?t(".autocomplete").css("display","none"):t(".autocomplete").css("display","block"),myautodata.keyword=e},200))),"undefined"!=typeof myautodata.data.rows)switch(o.keyCode){case 38:t("#"+myautodata.focusIndex+" td").removeClass("sel-hover"),myautodata.focusIndex>0?myautodata.focusIndex=myautodata.focusIndex-1:myautodata.focusIndex=myautodata.data.rows.length-1,t("#"+myautodata.focusIndex+" td").addClass("sel-hover");break;case 40:t("#"+myautodata.focusIndex+" td").removeClass("sel-hover"),myautodata.focusIndex==myautodata.data.rows.length-1?myautodata.focusIndex=0:myautodata.focusIndex=myautodata.focusIndex+1,t("#"+myautodata.focusIndex+" td").addClass("sel-hover");break;case 13:this._showSelectInfo(myautodata.focusIndex),this._clearData();break;case 37:a._goPage(myautodata.data.page-1,myautodata.data.total);break;case 39:a._goPage(myautodata.data.page+1,myautodata.data.total)}},_onpaste:function(e){undefined;""!=(window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):e.originalEvent.clipboardData.getData("Text"))&&setTimeout(function(){a._getData(1);var e=t("#myautocompleteinput").val();""==t.trim(e)?t(".autocomplete").css("display","none"):t(".autocomplete").css("display","block")})},_clearData:function(a){myautodata.focusIndex=-1,myautodata.data={},1!=a&&t(".autocomplete").css("display","none")},_getData:function(e){this._clearData(1);var o=t("#myautocompleteinput").val();if(""!=t.trim(o)){o=(o=Base64.encode(o)).replace(/\+/g,"%2B");var i=this.options.url;i=i.indexOf("?")>=0?i+"&random_num="+creatRandomNum():i+"?random_num="+creatRandomNum(),t.ajax({type:"GET",async:!0,dataType:"json",url:i+"&page="+e+"&rows="+this.options.rows+"&searchTerm="+o,success:function(e){e.success&&e.total>0?(myautodata.data=e,a._refresh()):(t(".autocomplete").empty(),t(".autocomplete").css("display","none"))}})}},_refresh:function(){t(".autocomplete").empty();var e="<table class='table table-condensed table-striped table-hover'>",o=this.options.columnData;e+="<thead class='head'>",myautodata.fillColume=o[0].columnName;for(var i=0;i<o.length;i++)1!=o[i].fillColumn&&"true"!=o[i].fillColumn||(myautodata.fillColume=o[i].columnName),e+="<th width='"+o[i].width+"%' class='center'>"+o[i].label+"</th>";e+="</thead>";for(var n=myautodata.data,l=0;l<n.rows.length;l++){e+="<tr id='"+l+"' class='info-tr'>";for(var s=0;s<o.length;s++){var u=o[s].columnName,c=n.rows[l][u],d=this.options.inputwidth*Number(o[s].width)/100-10;e+="<td class='center' width='"+o[s].width+"%'><div class='auto-textoverflow' title='"+c+"' style='width:"+d+"px;text-overflow: ellipsis;overflow: hidden;white-space: nowrap;'>"+c+"</div></td>"}e+="</tr>"}e+="<tr class='page'><td align='center' colspan='"+o.length+"'><a class='leftpage' title='首页' id='first_page'><i class='glyphicon first-page'></i></a><a class='leftpage' title='上一页' id='pre_page'><i class='glyphicon prev-page'></i></a><span>第"+n.page+"页</span><span>|</span><span>共"+n.total+"页</span><a class='rightpage' title='下一页' id='next_page'><i class='glyphicon next-page'></i></a><a class='rightpage' title='尾页' id='last_page'><i class='glyphicon last-page'></i></a></td></tr>",t(e+="</table>").appendTo(".autocomplete"),t("#first_page").bind("click",function(){a._goPage(1,n.total)}),t("#pre_page").bind("click",function(){a._goPage(n.page-1,n.total)}),t("#next_page").bind("click",function(){a._goPage(n.page+1,n.total)}),t("#last_page").bind("click",function(){a._goPage(n.total,n.total)}),t(".info-tr").bind("click",function(){a._showSelectInfo(this.id)}),t(".info-tr").mouseover(function(){myautodata.focusIndex=-1,t(".autocomplete td").removeClass("sel-hover"),t("#"+this.id+" td").addClass("sel-hover")}).mouseout(function(){t("#"+this.id+" td").removeClass("sel-hover")})},_goPage:function(t,a){t>a||t<1||myautodata.data.page!=t&&this._getData(t)},_showSelectInfo:function(a){var e=myautodata.data,o=myautodata.fillColume;if(-1!=a){var i=e.rows[a][o];t("#myautocompleteinput").val(i),this.options.inputVal=t("#myautocompleteinput").val(),this.options.person_id=e.rows[a].person_id,myautodata.keyword=i,t(".autocomplete").empty(),this.options.afterSelHandler(e.rows[a])}},_isPlaceholer:function(){return"placeholder"in document.createElement("input")},_destroy:function(){a.element.empty()},inputVal:function(){return this.options.inputVal},getPersonId:function(){return this.options.person_id},clear:function(){t("#myautocompleteinput").val("")},initInput:function(a){t("#myautocompleteinput").val(a)}})}(jQuery);