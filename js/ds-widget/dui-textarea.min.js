!function(t){var i,e={};t.widget("dui.textarea",{options:{height_auto:!1,width:"",height:"100px",max_height:"200px",word_length:500,index:1,tips:"",onChange:null,initShowTips:!0},_create:function(){if(i=this,""!=this.options.width&&this.element.css("width",this.options.width),this.options.height_auto){if(this.changer=t("<div>",{contenteditable:!0,"class":"form-control auto-textarea",id:"dui-textarea-"+this.options.index}).appendTo(this.element),t("#dui-textarea-"+this.options.index).css("min-height",this.options.height),t("#dui-textarea-"+this.options.index).css("max-height",this.options.max_height),""!=this.options.tips){var n='<label id="replace_tip_'+this.options.index+'" style="left:13px;top:7px;color:#999">'+this.options.tips+"</label>";e[this.options.index]=n,t(n).appendTo("#dui-textarea-"+this.options.index),t("#dui-textarea-"+this.options.index).bind("focus",function(){var i=this.id.substring(13);t("#replace_tip_"+i).length>0&&t("#dui-textarea-"+i).empty()}),t("#dui-textarea-"+this.options.index).bind("blur",function(){var i=this.id.substring(13),n=t("#dui-textarea-"+i).text();if(""==t.trim(n)){t("#dui-textarea-"+i).empty();var o=e[i];t(o).appendTo("#dui-textarea-"+i)}})}}else this.changer=t("<textarea>",{height:this.options.height,"class":"form-control",placeholder:this.options.tips,id:"dui-textarea-"+this.options.index}).appendTo(this.element);this.element.append("<div style='float:right'><label class='tip-style' id='tip-"+this.options.index+"'>最多支持输入"+this.options.word_length+"个字符</label><input type='hidden' value='"+this.options.word_length+"'/></div>"),t("#dui-textarea-"+this.options.index).bind("keyup",function(){var e=this.id.substring(13),n=t("#tip-"+e).parent().find("input").val();i._showTip(e,n),i._change()}),t("#dui-textarea-"+this.options.index).bind("paste",function(e){var n=this.id.substring(13),o=t("#tip-"+n).parent().find("input").val();i._onPaste(n,o,e),i._change()}),this.options.initShowTips||(t("#tip-"+this.options.index).hide(),t("#dui-textarea-"+this.options.index).bind("blur",function(){var i=this.id.substring(13);t("#tip-"+i).hide()}),t("#dui-textarea-"+this.options.index).bind("click",function(){var i=this.id.substring(13);t("#tip-"+i).show()}))},_change:function(){null!=this.options.onChange&&this.options.onChange()},_isPlaceholer:function(){return"placeholder"in document.createElement("input")},_showTip:function(i,e){var n=t("#dui-textarea-"+i).get(0).tagName;if("TEXTAREA"==n)var o=t.trim(t("#dui-textarea-"+i).val()),s=(o=o.replaceAll("\n","")).length;else s=t.trim(t("#dui-textarea-"+i).text()).length;var a=e-s;if(0==s)t("#tip-"+i).text("最多支持输入"+a+"个字符");else if(a<=0){if("TEXTAREA"==n){h=t("#dui-textarea-"+i).val().replaceAll("\n","").substring(0,e);t("#dui-textarea-"+i).val(h)}else{var h=t("#dui-textarea-"+i).text().substring(0,e);t("#dui-textarea-"+i).text(h)}t("#tip-"+i).text("剩余0个字符")}else t("#tip-"+i).text("剩余"+a+"个字符")},_onPaste:function(e,n,o){var s=undefined;if(""!=(s=window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):o.originalEvent.clipboardData.getData("Text"))){var a=t("#dui-textarea-"+e).get(0).tagName;setTimeout(function(){if(i._showTip(e,n),"DIV"==a){s=s.replace(/<[^>]+>/g,""),t("#dui-textarea-"+e).text(s)}})}},_destroy:function(){i.element.empty()},value:function(){if(this.options.height_auto)t("#replace_tip_"+this.options.index).length>0?this.options.value="":(i=(i=t.trim(t("#dui-textarea-"+this.options.index)[0].innerHTML)).replaceAll("&nbsp;"," "),i=t.trim(i),t("#dui-textarea-"+this.options.index)[0].innerHTML=i,this.options.value=i);else{var i=t.trim(t("#dui-textarea-"+this.options.index).val());i=i.replaceAll("\n","</br>"),this.options.value=i,t("#dui-textarea-"+this.options.index).val(t.trim(t("#dui-textarea-"+this.options.index).val()))}return this.options.value},clear:function(){if(this.options.height_auto){if(t("#dui-textarea-"+this.options.index).text(""),""!=this.options.tips){var i=e[this.options.index];t(i).appendTo("#dui-textarea-"+this.options.index)}}else t("#dui-textarea-"+this.options.index).val("");t("#tip-"+this.options.index).text("最多支持输入"+this.options.word_length+"个字符")},initContent:function(i){var e=t.trim(i);this.options.height_auto?(t("#dui-textarea-"+this.options.index)[0].innerHTML=e,this._showTip(this.options.index,this.options.word_length)):(e=e.replaceAll("</br>","\n"),t("#dui-textarea-"+this.options.index).val(e),this._showTip(this.options.index,this.options.word_length))}})}(jQuery);