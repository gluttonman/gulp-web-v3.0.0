!function(e){var t,n,o={struc_id:"",struc_name:""},r=!0,s=new Array;e.widget("dui.dropDownStruc",{options:{type:"1",initType:"1",width:180,scheme_id:"-1",tips:"请选择结构",init_struc_code:"",onStrucCheck:null,onSchemeChange:null},_create:function(){n=this,this.element.addClass("myDropDownStruc"),e(".myDropDownStruc").hover(function(){r=!1},function(){r=!0,e(".drop-struc-border").hide()}),this.changer=e("<input>",{type:"text","class":"form-control mystruc-tree",width:this.options.width+"px",value:this.options.tips,readonly:"readonly"}).appendTo(this.element),this._on(this.changer,{focus:this._onfocus,click:this._onclick,blur:this._onblur});var t=this.options.width+23;this.changer=e("<div>",{width:t+"px","class":"drop-struc-border ztree-struc none"}).appendTo(this.element),this.changer=e("<ul>",{id:"tree","class":"ztree"}).appendTo(".drop-struc-border")},_onfocus:function(){"-1"!=this.options.scheme_id&&e(".drop-struc-border").show()},_onclick:function(){"-1"!=this.options.scheme_id&&e(".drop-struc-border").show()},_onblur:function(){r&&e(".drop-struc-border").hide()},_loadTree:function(){var n={edit:{enable:!0,drag:{autoExpandTrigger:!1,isCopy:!1,isMove:!1},editNameSelectAll:!0,showRemoveBtn:!1,showRenameBtn:!1},async:{enable:!0,type:"post",url:url_path_action_login+"/resource/getStructureAsyncInfo?random_num="+creatRandomNum(),autoParam:["id"],otherParam:{scheme_id:this.options.scheme_id}},callback:{onClick:this._onztreeclick,onAsyncSuccess:this._onZtreeAsyncSuccess}};e.fn.zTree.init(e("#tree"),n),t=e.fn.zTree.getZTreeObj("tree"),this.options.treeobj=t},_onZtreeAsyncSuccess:function(r,s,i,c){if(null!=t){null!=n.options.onSchemeChange&&n.options.onSchemeChange();var a=t.getNodes();if(t.expandNode(a[0],!0),t.selectNode(a[0]),"1"==n.options.initType)if("undefined"==typeof a[0])o={};else{var u=a[0].name;e(".mystruc-tree").val(u),o.struc_id=a[0].id,o.struc_name=u,o.struc_code=a[0].structure_code,o.is_parent=a[0].isParent}if(""!=n.options.init_struc_code){var d=n.options.init_struc_code.split("_");if(d.length>2){for(var l=1;l<d.length-1;l++)t.expandNode(t.getNodeByParam("id",d[l]),!0);if(null!=(p=t.getNodeByParam("id",d[d.length-1]))){if(t.selectNode(p),o.struc_id=d[d.length-1],o.struc_name=p.name,o.struc_code=p.structure_code,o.is_parent=p.isParent,"1"==n.options.type)h=_nname;else h=n._getpname(p,"string");e(".mystruc-tree").val(h)}}else if(2==d.length){var p=t.getNodeByParam("id",d[1]);if(t.selectNode(p),null!=p){if(o.struc_id=d[1],o.struc_name=p.name,o.struc_code=p.structure_code,o.is_parent=p.isParent,"1"==n.options.type)h=_nname;else var h=n._getpname(p,"string");e(".mystruc-tree").val(h)}}else 1==d.length&&t.selectNode(a[0])}}},_onztreeclick:function(r,s,i,c){var a=t.getSelectedNodes()[0],u=a.name;if(o.struc_id=a.id,o.struc_name=u,o.struc_code=a.structure_code,o.is_parent=a.isParent,"1"==n.options.type)d=u;else var d=n._getpname(a,"string");e(".mystruc-tree").val(d),e(".drop-struc-border").hide(),null!=n.options.onStrucCheck&&n.options.onStrucCheck()},_getpname:function(e,t){if(null==e)return"";var n=e.name,o=e.id;s.push({id:o,name:n});var r=e.getParentNode();return null!=r&&("string"==t?n=this._getpname(r,t)+"->"+n:"json"==t&&this._getpname(r,t)),"string"==t?n:"json"==t?s:void 0},_destroy:function(){n.element.empty()},loadTree:function(e){this.options.scheme_id=e,this._loadTree()},clearInput:function(){e(".mystruc-tree").val(this.options.tips),o={}},getValue:function(){return this.options.getValue=o,this.options.getValue}})}(jQuery);