function initAction_path_html(){var e=document.location.pathname,t=e.lastIndexOf("/"),a=e.lastIndexOf(".html");action_path_html=e.substring(t+1,a)}function initHdStatusParam(){template.helper("getHdStatus",function(e,t){var a=new Date,o=new Date(e.replace(/-/g,"/")),n=new Date(t.replace(/-/g,"/"));return a.getTime()<o.getTime()?"<span style='color:green'>[未开始]</span>":a.getTime()>n.getTime()?"[已结束]":"<span style='color:red'>[进行中]</span>"})}function dataRender(e,t,a,o,n,i){$.ajax({async:!0,url:t,type:n,data:e,dataType:"json",success:function(e){renderByData(o,a,e),undefined!=i&&i(e)}})}function dataRenderSync(e,t,a,o,n,i){$.ajax({async:!1,url:t,type:n,data:e,dataType:"json",success:function(e){renderByData(o,a,e),undefined!=i&&i(e)}})}function renderByData(e,t,a){var o=template(e,a);$("#"+t).html(o)}function go2Page(e,t){page=Number(e),total=Number(t),page>total||page<1||renderData(e)}function checkPage(e,t){var a=Number(e.value),o=Number(t);return a>o?e.value=o:a<1&&(e.value=1),!0}function checkNum(e){return/^[1-9][0-9]{0,100}$/.test(e.value)?0!=e.value||(e.value=1,!0):(e.value="",!1)}function dateToStr(e,t){e=arguments[0]||new Date;var a=t=arguments[1]||"yyyy-MM-dd HH:mm",o=["日","一","二","三","四","五","六"];return a=a.replace(/yyyy|YYYY/,e.getFullYear()),a=a.replace(/yy|YY/,e.getYear()%100>9?(e.getYear()%100).toString():"0"+e.getYear()%100),a=a.replace(/MM/,e.getMonth()>=9?e.getMonth()+1:"0"+(e.getMonth()+1)),a=a.replace(/M/g,e.getMonth()),a=a.replace(/w|W/g,o[e.getDay()]),a=a.replace(/dd|DD/,e.getDate()>9?e.getDate().toString():"0"+e.getDate()),a=a.replace(/d|D/g,e.getDate()),a=a.replace(/hh|HH/,e.getHours()>9?e.getHours().toString():"0"+e.getHours()),a=a.replace(/h|H/g,e.getHours()),a=a.replace(/mm/,e.getMinutes()>9?e.getMinutes().toString():"0"+e.getMinutes()),a=a.replace(/m/g,e.getMinutes()),a=a.replace(/ss|SS/,e.getSeconds()>9?e.getSeconds().toString():"0"+e.getSeconds()),a=a.replace(/s|S/g,e.getSeconds())}function dateAddHour(e,t){var a=3600*t*1e3;return a+=e.getTime(),new Date(a)}function getHoleOrgId(){for(var e=99999,t=document.getElementsByTagName("script"),a=0;a<t.length;a++){var o=t[a];if(o.src.indexOf("?id=")>0){e=o.src.split("?id=")[1];break}}return e}function getSel_stage_subject(e){$("#"+e).length>0&&(0==xd_subject_type?$("#"+e).html('<span>学段学科：</span><select class="form-control" id="sel_stage" style="width:100px;"><option value="0">全部</option></select>&nbsp;&nbsp;<select class="form-control" id="sel_subject" style="width:100px;"><option value="0">全部</option></select>'):$("#"+e).html('<span>学段学科：</span><select class="form-control" id="sel_stage" style="width:100px;"></select>&nbsp;&nbsp;<select class="form-control" id="sel_subject" style="width:100px;"></select>')),$.ajax({async:!1,url:url_path_html+"/resource/getStageSubject?random_num="+Math.random(),type:"post",dataType:"json",success:function(e){e.success&&(xd_subject_list=e.xd_subject_list,getStageList())}})}function getStageList(){if(xd_subject_list.length>0){for(var e=0;e<xd_subject_list.length;e++)$("#sel_stage").append('<option value="'+xd_subject_list[e].xd_id+'">'+xd_subject_list[e].xd_name+"</option>");$(document).on("change","#sel_stage",function(){getSubjectList()})}}function getSubjectList(){var e=$("#sel_stage").val();if(0==xd_subject_type?$("#sel_subject").html('<option value="0">全部</option>'):$("#sel_subject").html(""),e>0){for(var t=null,a=0;a<xd_subject_list.length;a++)if(xd_subject_list[a].xd_id==e){t=xd_subject_list[a].subject_list;break}if(null!=t&&t.length>0)for(a=0;a<t.length;a++)65!=t[a].subject_id&&70!=t[a].subject_id&&71!=t[a].subject_id&&64!=t[a].subject_id&&68!=t[a].subject_id&&69!=t[a].subject_id&&$("#sel_subject").append('<option value="'+t[a].subject_id+'">'+t[a].subject_name+"</option>")}}function initSelectStageSubject(e,t){null==e&&(e=0),null==t&&(t=0),getSel_stage_subject("sel_stage_subject"),e>0&&$("#sel_stage").val(e),getSubjectList(),t>0&&$("#sel_subject").val(t)}function initStageSubject(e){for(var t=0;t<e.list.length;t++){for(var a=null,o=0;o<xd_subject_list.length;o++)if(e.list[t].stage_id==xd_subject_list[o].xd_id){a=xd_subject_list[o];break}if(null!=a){e.list[t].stage_name=a.xd_name;for(var n=0;n<a.subject_list.length;n++)if(e.list[t].subject_id==a.subject_list[n].subject_id){e.list[t].subject_name=a.subject_list[n].subject_name;break}}else e.list[t].stage_name="",e.list[t].subject_name="全部"}}function getPersonInfo(){$.ajax({url:url_path_html+"/person/getPersonInfo?random_num="+Math.random(),async:!1,type:"POST",data:{person_id:$.cookie("person_id"),identity_id:$.cookie("identity_id")},dataType:"json",success:function(e){if(e.success){$.cookie("background_person_id",$.cookie("person_id"),{path:"/"}),$.cookie("background_person_name",$.cookie("person_name"),{path:"/"}),$.cookie("background_identity_id",$.cookie("identity_id"),{path:"/"}),$.cookie("background_token",$.cookie("token"),{path:"/"}),$.cookie("background_bureau_id",e.table_List.bureau_id,{path:"/"}),$.cookie("background_bureau_name",e.table_List.bureau_name,{path:"/"}),$.cookie("background_bureau_type",e.table_List.bureau_type,{path:"/"}),$.cookie("background_province_id",e.table_List.province_id,{path:"/"}),$.cookie("background_city_id",e.table_List.city_id,{path:"/"}),$.cookie("background_district_id",e.table_List.district_id,{path:"/"}),$.cookie("background_school_id",e.table_List.school_id,{path:"/"});var t=e.table_List.stage_name+e.table_List.subject_name;if(t=0==t?"全部学科":t,$.cookie("background_stage_subject_name",t,{path:"/"}),null!=e.table_List.roles&&e.table_List.roles.length>0){for(var a="",o=0;o<e.table_List.roles.length;o++)a=(a=(a=a+e.table_List.roles[o].role_code.toUpperCase()+",")+e.table_List.roles[o].role_id+",")+e.table_List.roles[o].role_name+";";a.indexOf(";")>0&&(a=a.substring(0,a.length-1)),$.cookie("background_role_str",a,{path:"/"}),a.indexOf("YX,")>-1?($.cookie("background_role_code","YX",{path:"/"}),$.cookie("background_yx_manage_org_id","99999",{path:"/"}),$.cookie("background_yx_manage_org_name","研修网",{path:"/"}),$.cookie("background_yx_manage_org_type",100,{path:"/"})):a.indexOf("YX_PROV_ADMIN,")>-1?undefined!=e.table_List.province_id&&e.table_List.province_id>0&&($.cookie("background_role_code","YX_PROV_ADMIN",{path:"/"}),$.cookie("background_yx_manage_org_id",e.table_List.province_id,{path:"/"}),$.cookie("background_yx_manage_org_name",e.table_List.province_name,{path:"/"}),$.cookie("background_yx_manage_org_type",101,{path:"/"})):a.indexOf("YX_CITY_ADMIN")>-1?undefined!=e.table_List.city_id&&e.table_List.city_id>0&&($.cookie("background_role_code","YX_CITY_ADMIN",{path:"/"}),$.cookie("background_yx_manage_org_id",e.table_List.city_id,{path:"/"}),$.cookie("background_yx_manage_org_name",e.table_List.city_name,{path:"/"}),$.cookie("background_yx_manage_org_type",102,{path:"/"})):a.indexOf("YX_AREA_ADMIN")>-1?undefined!=e.table_List.district_id&&e.table_List.district_id>0&&($.cookie("background_role_code","YX_AREA_ADMIN",{path:"/"}),$.cookie("background_yx_manage_org_id",e.table_List.district_id,{path:"/"}),$.cookie("background_yx_manage_org_name",e.table_List.district_name,{path:"/"}),$.cookie("background_yx_manage_org_type",103,{path:"/"})):a.indexOf("YX_SCHOOL_ADMIN")>-1&&e.table_List.bureau_id==e.table_List.school_id&&($.cookie("background_role_code","YX_SCHOOL_ADMIN",{path:"/"}),$.cookie("background_yx_manage_org_id",e.table_List.bureau_id,{path:"/"}),$.cookie("background_yx_manage_org_name",e.table_List.bureau_name,{path:"/"}),$.cookie("background_yx_manage_org_type",104,{path:"/"}))}getTeacherInfo()}}})}function getTeacherInfo(){$.ajax({url:url_path_html+"/management/per/getTeacherInfo?random_num="+Math.random(),async:!1,type:"POST",data:{teacher_id:$.cookie("person_id")},dataType:"json",success:function(e){e.success&&($.cookie("background_stage_id",e.table_list.columns.STAGE_ID,{path:"/"}),$.cookie("background_subject_id",e.table_list.columns.SUBJECT_ID,{path:"/"}),$.cookie("background_xb_name",e.table_list.columns.XB_NAME,{path:"/"}))}})}function checkLogin(){$.cookie("avatar_url",getYptPersonTx(),{path:"/"}),getPersonInfo(),changeLogin()}function doLogout(e){var t=url_path_html+"/login/doLogout?type=2&t="+Math.random();$.ajax({url:t,type:"get",async:!1,success:function(t){null!=e?window.location=e:changeLogout()}})}function getYptPersonTx(){var e="";return $.ajax({async:!1,method:"POST",url:url_path_html+"/space/common/getAvatar?random_num="+Math.random(),data:{person_id:$.cookie("person_id"),identity_id:$.cookie("identity_id")},dataType:"json",success:function(t){if(t.success){var a=t.avatar_file_id,o=a.substring(0,2);img_path=url_path_html+"/html/thumb/Material/"+o+"/"+a,e=img_path}}}),e}var icomet_path="http://www.zgjsyxw.com",v_subUrl=icomet_path+"/front/poll",v_signUrl=icomet_path+"/icomet/sign",action_path_html;initAction_path_html(),initHdStatusParam();var xd_subject_list=null,xd_subject_type=0;