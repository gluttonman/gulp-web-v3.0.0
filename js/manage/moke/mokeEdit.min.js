function initEvent(){$(document).on("change","#sel_stage",function(){changeScheme()}),$(document).on("change","#sel_subject",function(){changeScheme()}),$(document).on("change","#scheme_id",function(){scheme_id=$(this).val(),changeStructure()})}function initBusiness(){var e=url_path_html+"/yx/moke/getMokeById?t="+(new Date).getTime();$.ajax({async:!0,url:e,data:{moke_id:moke_id},type:"post",dataType:"json",success:function(e){$("#moke_title").val(e.title),$("#sel_stage").val(e.stage_id),$("#sel_subject").val(e.subject_id),initSelectStageSubject(e.stage_id,e.subject_id),changeScheme(e.scheme_id),structure_id=e.structure_id,mokeSubmitFinish()}})}function mokeSubmit(e){var t=$("#sel_stage").val(),i=$("#sel_stage option:selected").html(),s=$("#sel_subject").val(),n=$("#sel_subject option:selected").html(),u=$.trim($("#moke_title").val());if(null!=struc&&(structure_id=getStrucValue().struc_id),null==u||""==$.trim(u))return art.dialog.alert("标题不能为空！"),!1;var a={moke_id:moke_id,stage_id:t,stage_name:i,subject_id:s,subject_name:n,scheme_id:scheme_id,structure_id:structure_id,title:u,business_type:business_type,business_id:business_id},o=url_path_html+"/yx/moke/addMoke?t="+Math.random();moke_id>0&&(o=url_path_html+"/yx/moke/editMoke?t="+Math.random()),$.ajax({async:!0,url:o,type:"post",data:a,dataType:"json",success:function(t){if(t.success)if(dialogClose("保存成功！",2,200),moke_id>0){if(1==e)return void saveCannel()}else moke_id=t.id,mokeSubmitFinish()}})}function allSubmit(){return 0==$("#resource_list_1 table tbody tr").length?void dialogOk("请上传教学设计！",300,""):0==$("#resource_list_2 table tbody tr").length?void dialogOk("请上传教学课件！",300,""):void $.ajax({async:!0,url:url_path_html+"/yx/moke/shenqingMoke?t="+Math.random(),type:"post",data:{moke_id:moke_id},dataType:"json",success:function(e){e.success?(dialogClose("申请成功！",2,200),saveCannel()):dialogClose("系统繁忙，请稍后再试！",2,200,"")}})}function mokeSubmitFinish(){$("#mokeSubmit").hide(),$("#otherInfoPannel").addClass("active"),listOthers()}function listOthers(){showResourceList(1),showResourceList(2),showResourceList(3),showResourceList(4)}function cannel(){"undefined"!=typeof parent.tb_remove&&parent.tb_remove()}function saveCannel(){setTimeout(function(){if(null!=callBack){var str="parent."+callBack+"()";eval(str)}cannel()},2e3)}function uploadFile(e){var t=2;1==e?t=2:2==e?t=3:3==e?t=13:4==e&&(t=17),hj_type=e;var i=url_path_html+"/yx/html/resource/uploadYxResource.html";i+="?service_type=51",i+="&service_id="+moke_id,i+="&hj_id="+e,i+="&stage_id="+$("#sel_stage").val(),i+="&subject_id="+$("#sel_subject").val(),i+="&scheme_id="+scheme_id,i+="&structure_id="+structure_id,i+="&appType_id="+t,i+="&res_type=14",i+="&TB_iframe=true",i+="&height=450",i+="&width=720",tb_show("上传资源",i,"thickbox")}function tb_remove(){return $("#TB_imageOff").unbind("click"),$("#TB_closeWindowButton").unbind("click"),$("#TB_window").fadeOut("200",function(){$("#TB_iframeContent").remove(),$("#TB_window,#TB_overlay,#TB_HideSelect").trigger("unload").unbind().remove()}),$("#TB_load").remove(),document.onkeydown="",document.onkeyup="",showResourceList(hj_type),!1}function showResourceList(e){var t=url_path_html+"/space/ypt/getResourceAll?t="+Math.random();$.ajax({url:t,type:"post",data:{res_type:51,pageNumber:1,pageSize:100,rtype:0,beike_type:e,view:moke_id,sort_num:2},dataType:"json",success:function(t){if(t.success&&null!=t.list){t=addServerUrlToJson(t),beforeRender(t),t.type=e;var i=template.render("resource_list_template",t);$("#resource_list_"+e).html(i)}}})}function changeBack(e){setTimeout(function(){showResourceList(e)},3e3)}var business_type=0,business_id=0,moke_id=0,callBack=null;$(document).ready(function(){if(undefined!=$.cookie("person_id")&&"null"!=$.cookie("person_id")&&5==$.cookie("identity_id")){if(null!=GetQueryString("business_type")&&null!=GetQueryString("business_id")&&(business_type=GetQueryString("business_type"),business_id=GetQueryString("business_id")),null!=GetQueryString("callBack")&&(callBack=GetQueryString("callBack")),null!=GetQueryString("id")&&(moke_id=GetQueryString("id")),initStructure(),moke_id>0)initBusiness();else{var e=$.cookie("background_stage_id"),t=$.cookie("background_subject_id");null!=GetQueryString("stage_id")&&(e=GetQueryString("stage_id")),null!=GetQueryString("subject_id")&&(t=GetQueryString("subject_id")),xd_subject_type=1,initSelectStageSubject(e,t),changeScheme(),$.ajax({async:!0,type:"POST",data:{},dataType:"json",url:url_path_html+"/yx/moke/queryStageSubject?t="+(new Date).getTime(),success:function(e){if(e.list){var t=e.list;$("#sel_stage").val(t.stage_id),$("#sel_subject").val(t.subject_id),$("#scheme_id").val(t.scheme_id)}}})}initEvent()}else alert("未登录")});var hj_type=1;