function initBusiness(e){e>0&&$.ajax({type:"post",async:!1,data:{id:e,expand_id:expand_id},dataType:"json",url:url_path_html+"/yx/article/findWZbyId?r="+Math.random(),success:function(e){$("#wz_title").val(e.title),$("#sel_stage").val(e.stage_id),getSubjectList(e.stage_id),$("#sel_subject").val(e.subject_id),$("#per_sort").val(e.person_category_id),$("#org_sort").val(e.org_category_id),(myue=UE.getEditor("editor",{toolbars:[tool_arr],initialFrameWidth:600,initialFrameHeight:350})).ready(function(){myue.setContent(e.content)})}})}function initUEditor(e){$("#editor").html(e),myue=UE.getEditor("editor",{toolbars:[tool_arr],initialFrameWidth:600,initialFrameHeight:330})}function cannel(){"undefined"!=typeof parent.tb_remove&&parent.tb_remove()}function articleSubmit(){var stage_id=$("#sel_stage").val(),subject_id=$("#sel_subject").val(),type_id=$("#wz_type").val(),type_name=$("#wz_type option:selected").html(),wz_title=$("#wz_title").val();if(null==wz_title||""==$.trim(wz_title))return dialogOk("文章标题不能为空！",300,""),!1;var wz_content="";if(myue.getKfContent(function(e){wz_content=e}),null==wz_content||""==$.trim(wz_content))return dialogOk("文章内容不能为空！",300,""),!1;if($.trim(wz_content).length>1e5)return dialogOk("文章内容过长！",300,""),!1;null!=share&&(share_ids=$('input[name="share_range_org"]:checked').val(),$("input[name='share_range_gourp']:checkbox").each(function(){$(this).attr("checked")&&(checkboxids+=$(this).val()+",")}),""!=checkboxids&&(checkboxids=checkboxids.substring(0,checkboxids.length-1)));for(var firstImg="",root=UE.htmlparser(wz_content,!0),imgs_=new Array,imgs_list=root.getNodesByTagName("img"),i=0;i<imgs_list.length;i++)imgs_[i]=imgs_list[i].getAttr("src"),0==i&&(firstImg=imgs_list[i].getAttr("src"));var overviewText=myue.getContentTxt().substring(0,100),url=url_path_html+"/yx/article/addArticle?math="+Math.random();wz_id>0&&(url=url_path_html+"/yx/article/editArticle?math="+Math.random()),$.ajax({async:!0,url:url,type:"post",data:{business_type:1,stage_id:$("#sel_stage").val(),stage_name:$("#sel_stage option:selected").text(),subject_id:$("#sel_subject").val(),subject_name:$("#sel_subject option:selected").text(),person_category_id:$("#per_sort").val(),person_id:$.cookie("person_id"),person_name:$.cookie("person_name"),identity_id:$.cookie("identity_id"),province_id:$.cookie("background_province_id"),city_id:$.cookie("background_city_id"),district_id:$.cookie("background_district_id"),school_id:$.cookie("background_school_id"),content:wz_content,id:wz_id,org_category_id:$("#org_sort").val(),title:wz_title,overview:overviewText,thumb_id:firstImg,thumb_ids:JSON.stringify(imgs_),service_type:service_type,service_id:service_id,hj_id:hj_id,share_ids:share_ids,checkboxids:checkboxids,random_num:Math.random()},dataType:"json",success:function(data){data.success?(dialogClose(0==wz_id?"添加成功！":"修改成功！",3,200,""),0==wz_id&&creditWriteToQueue(107,data.id,"","",$.cookie("person_name")+"发表了文章"+wz_title+"。",data.expand_id),setTimeout(function(){if(null!=callBack){var fun="parent."+callBack+"()";eval(fun)}cannel()},3e3)):dialogClose("系统繁忙！",3,200,"")}})}function creditWriteToQueue(e,t,i,r,n){if(0==creditFlag)return!1;var a="",o="";return!!$.cookie("person_id")&&(a=$.cookie("person_id"),o=$.cookie("identity_id"),$.cookie("person_id")!=i&&void $.ajax({type:"POST",async:!0,data:{random_num:creatRandomNum(),person_id:a,identity_id:o,platform_type:1,ip_addr:"",operation_system:"",browser:"",business_type:e,relatived_id:t,r_person_id:i,r_identity_id:r,operation_content:n},url:url_path_action_login+"/credit/writeToQueue",dataType:"json",success:function(e){},error:function(){}}))}var wz_id=0,share=null,share_ids=0,checkboxids="",expand_id=0,creditFlag=1,service_type=0,service_id=0,param_stage_id=0,param_subject_id=0,hj_id=1,callBack=null,myue;$(function(){if(undefined!=$.cookie("person_id")&&"null"!=$.cookie("person_id")&&5==$.cookie("identity_id")){callBack=GetQueryString("callBack"),wz_id="undefined"!=GetQueryString("id")?parseInt(GetQueryString("id")):0,expand_id="undefined"!=GetQueryString("expand_id")?parseInt(GetQueryString("expand_id")):0,null!=GetQueryString("service_type")&&GetQueryString("service_id")?(service_type=GetQueryString("service_type"),service_id=GetQueryString("service_id")):share=$("#myshare").sharerange({type:2}),null!=GetQueryString("hj_id")&&(hj_id=GetQueryString("hj_id"));var e=$.cookie("background_stage_id"),t=$.cookie("background_subject_id");param_stage_id=null==GetQueryString("stage_id")?0:GetQueryString("stage_id"),param_subject_id=null==GetQueryString("subject_id")?0:GetQueryString("subject_id"),param_stage_id>0&&param_subject_id>0&&(e=param_stage_id,t=param_subject_id),initSelectStageSubject(e,t),getPersonSortList(function(){getOrgSortList(function(){wz_id>0?initBusiness(wz_id):initUEditor("")})})}});