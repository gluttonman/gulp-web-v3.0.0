function initMsTag(){$.ajax({url:url_path_html+"/yx/config/getMsTag?random_num="+creatRandomNum(),method:"POST",async:!1,dataType:"json",success:function(e){if(e.success){for(var t="",a=0;a<e.list.length;a++)t=0==a?'<input type="radio" value="'+e.list[a].ms_id+'" checked="true" name="ms_tag"/>'+e.list[a].ms_name:t+'<input type="radio" value="'+e.list[a].ms_id+'" name="ms_tag"/>'+e.list[a].ms_name;$("#ms_tag").html(t)}}})}function searchFun(){key=keyword.search("value"),goPage(1)}function checkAll(){var e=document.getElementsByName("chk_person");if(document.getElementById("chk_delAll").checked)for(t=0;t<e.length;t++)0==e[t].disabled&&(e[t].checked=!0);else for(var t=0;t<e.length;t++)0==e[t].disabled&&(e[t].checked=!1)}function nocheck(){var e=document.getElementsByName("chk_person"),t=$('input[name="chk_person"]:checked');e.length!=t.length&&$("#chk_delAll").attr("checked",!1)}function batchJoinPersons(){var e,t=$("input[name='chk_person']:checked");if(0==t.length)return void showAlert({content:"请选择用户。",time:2});for(var a=new Array,n=0;n<t.length;n++)if("-1"!==t[n].value){var o=t[n].value;e=tableData[o],a.push([e.person_id,e.identity_id,e.person_name])}a.length>0&&joinPerson(a)}function add2Group(e,t){var a=tableData[e],n=new Array;n.push([a.person_id,a.identity_id,a.person_name]),joinPerson(n)}function joinPerson(e){var t=$("input[name='ms_tag']:checked").val();$.ajax({url:url_path_html+"/yx/team/setGzs?random_num="+creatRandomNum(),method:"POST",async:!1,data:{paramJSON:JSON.stringify(e),ms_id:t},dataType:"json",success:function(e){e.success?dialogClose("保存成功，正在刷新成员列表",2,330,"cancel();"):"notlogin"==e.info?top.location=url_path_action+"/":null!=e.info&&""!=e.info?alert(e.info):alert("设置失败，请刷新页面后重试。")}})}function cancel(){self.parent.tb_remove()}function goPage(e){pg=new showPages("pg"),pg.pageCount=totalPage,0==e&&(e=1),pg.toPage(e)}function zTreeOnClick(e,t,a){$("#orgId").val(a.id),nodeId=a.id,orgType=a.org_type,goPage(1)}function zTreeBeforeExpand(e,t){zTreeObj.setting.async.otherParam.org_type=t.org_type}function renderData(e){goPage(e)}function getOrgList(){var e=$.cookie("background_yx_manage_org_id");$.ajax({url:url_path_html+"/management/sys/org/getEduUnitByOrgId?org_id="+e,type:"get",async:!1,dataType:"json",success:function(t){t.success&&(0==t.PROVINCE_ID?getAreaNodeList(e,0):t.PROVINCE_ID>0&&0==t.CITY_ID?getAreaNodeList(e,1):t.PROVINCE_ID>0&&t.CITY_ID>0&&0==t.DISTRICT_ID?getAreaNodeList(e,2):getSchoolNodeList(e,null))}})}function getAreaNodeList(e,t){$.ajax({url:url_path_html+"/yx/getAsyncOrgTree?random_num="+creatRandomNum(),type:"POST",async:!1,data:{org_id:e,org_type:t,get_next:1},dataType:"json",success:function(t){null!=t&&getSchoolNodeList(e,t)}})}function getSchoolNodeList(e,t){null==t&&(t=new Array),$.ajax({url:url_path_html+"/yx/getOrgTreeById?random_num="+creatRandomNum(),type:"POST",async:!1,data:{id:e,root_id:e},dataType:"json",success:function(a){if(a.length>0)for(var n=!1,o=0;o<a.length;o++){var r={id:a[o].id,pId:a[o].pId,name:a[o].name,org_type:a[o].unit_type,isParent:a[o].isParent};t.push(r),a[o].ORG_ID==e&&(n=!0)}if(!n&&99999!=e){var i={id:e,pId:0,org_type:2,name:getOrgName(e)};t.push(i)}zTreeObj=$.fn.zTree.init($("#tree"),setting,t)}})}function getOrgName(e){var t=null;return $.ajax({url:url_path_html+"/management/sys/org/getEduUnitByOrgId?random_num="+creatRandomNum(),type:"POST",async:!1,data:{org_id:e},dataType:"json",success:function(e){t=e.ORG_NAME}}),t}function getDataList(e){$("#chk_delAll").attr("checked",!1);$("#workroom_id").val();var t=Base64.encode(key);if(t=t.replace(/\+/g,"%2B"),nodeId==undefined)return void showAlert({content:"请在左侧选择机构。",time:2});$.ajax({url:url_path_html+"/yx/getOrgUser?random_num="+creatRandomNum(),type:"POST",async:!1,data:{org_id:nodeId,rangeType:1,stage_id:stage_id,subject_id:subject_id,keyword:t,pageNumber:e,pageSize:10},dataType:"json",success:function(t){if(t.success){$("#pagenumber_cur").val(e),$("#pageNumber").val(t.pageNumber),$("#totalRow").val(t.totalRow),$("#pageSize").val(t.pageSize),$("#totalPage").val(t.totalPage),tableData=t.list;var a=template.render("test",t);document.getElementById("table2").innerHTML=a,$("#totalPage").val(t.totalPage)}else"notlogin"==t?top.location=url_path_action+"/":alert(t.info)}}),$(".que-content-img").css("height","279px"),$(".que-content-img").css("border-bottom-width","1px")}var group_type="1",stage_id="-1",subject_id="-1",tableData,zTreeObj,groupId,orgType,nodeId,groupIdQz=$(self.parent.document).find("#hidden_groupId").val(),groupName=$(self.parent.document).find("#hidden_groupName").val(),setting={async:{enable:!0,url:url_path_html+"/yx/getAsyncOrgTree",autoParam:["id=org_id"],otherParam:{org_type:3,get_next:1}},check:{enable:!1,chkboxType:{Y:"ps",N:"ps"}},data:{key:{name:"name"},simpleData:{enable:!0,idKey:"id",pIdKey:"pId"}},callback:{beforeExpand:zTreeBeforeExpand,onClick:zTreeOnClick}},keyword;$(document).ready(function(){initMsTag();var e={success:!0,list:[],init_flag:!0},t=template.render("test",e);document.getElementById("table2").innerHTML=t,$(".que-content-img").css("height","327px"),$(".que-content-img").css("border-bottom-width","0"),$("#clearButton").hide(),getOrgList(),xdkm1=$("#xdkm_demo1").stagesubject({change:function(){var e=xdkm1.stagesubject("getValue");stage_id=e.stage_id,subject_id=e.subject_id}}),$("#xdkm_demo1 #mystage span").hide(),$("#xdkm_demo1 #mystage select").css({width:"130px",margin:"10.3px 0px 8px 4px"}),$("#xdkm_demo1 #mysubject span").hide(),$("#xdkm_demo1 #mysubject select").css({width:"130px",margin:"10.3px 0px 8px 4px"}),keyword=$("#search_input").search({maxinput:10,inputwidth:155,onsearch:function(){searchFun()}}),$("._idiv").prepend('<input id="hiddenText" type="text" style="display:none" />'),$("#search_keyword").keydown(function(e){13==e.which&&setTimeout(function(){goPage($("#pageNumber").val()),stopBubble(e)},0)})});var key="";