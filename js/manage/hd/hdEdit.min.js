function initBusiness(){var t=url_path_html+"/yx/hd/findHdById?t="+(new Date).getTime();$.ajax({async:!0,url:t,data:{id:hd_id},type:"post",dataType:"json",success:function(t){hd_confid=(detail=t).hd_confid,$("#hd_name").val(detail.hd_name),$("#con_pass").val(detail.con_pass),$("#team_type").val(detail.team_type),$("#team_id").val(detail.team_id),$("#team_name").val(detail.team_name),$("#content1").val(detail.hd_content),detail.is_show>0?$("#publicHd").trigger("click"):$("#privateHd").trigger("click"),$("#sel_stage").val(detail.stage_id),$("#sel_subject").val(detail.subject_id),initSelectStageSubject(detail.stage_id,detail.subject_id),$("#lx_id").val(detail.lx_id),initDefaultPlugins(detail),$("#start_time").removeAttr("onfocus"),dateToStr()>$("#end_time").val()&&($("#end_time").removeAttr("onfocus"),$("#con_pass").attr("disabled",!0),can_change_meeting=0)}})}function initDefaultPlugins(t){if(undefined!=t)$("#start_time").val(t.start_time),$("#end_time").val(t.end_time),$("#main_person_id").val(t.main_person_id),$("#main_person_name").val(t.main_person_name);else{var e=$.cookie("background_stage_id"),a=$.cookie("background_subject_id");null!=GetQueryString("stage_id")&&(e=GetQueryString("stage_id")),null!=GetQueryString("subject_id")&&(a=GetQueryString("subject_id")),initSelectStageSubject(e,a),$("#start_time").val(dateToStr()),$("#end_time").val(dateToStr(dateAddHour(new Date,1))),$("#main_person_id").val($.cookie("person_id")),$("#main_person_name").val($.cookie("person_name"))}}function selectPerson(){var t=url_path_html+"/yx/html/manage/hd/areaPerson.html?id="+$("#team_id").val();art.dialog.open(t,{title:"参与群组",height:450,width:680,zIndex:9999,opacity:0,lock:!0,ok:function(){var t=this.iframe.contentWindow,e=t.$("input[type=radio]:checked").val();$("#team_id").val(e);var a=t.$("input[type=radio]:checked").parent().siblings("td").text();a=$.trim(a),$("#team_name").val(a)},cancel:function(){}})}function loadHdlx(t){var e=url_path_html+"/yx/hd/hdlxList";dataRender(null,e,"lx_id","hdlx_template","get",function(){$("#lx_id").on("change",function(){"集体备课"==$(this).find("option:selected").text()&&null==GetQueryString("team_id")&&$("#team_select").show()}),t&&t()})}function hdSubmit(){$("#hdSubmitBtn").attr("disabled",!0);var stage_id=$("#sel_stage").val(),stage_name=$("#sel_stage option:selected").html(),subject_id=$("#sel_subject").val(),subject_name=$("#sel_subject option:selected").html(),lx_id=$("#lx_id").val(),lx_name=$("#lx_id").find("option:selected").text(),team_type=$("#team_type").val(),team_id=$("#team_id").val(),team_name=$("#team_name").val(),hd_content=$("#content1").val(),is_show=$("input[name='pop']:checked").val();if(3==lx_id){if(0==stage_id)return art.dialog.alert("请选择学段！"),$("#hdSubmitBtn").attr("disabled",!1),!1;if(0==subject_id)return art.dialog.alert("请选择学科！"),$("#hdSubmitBtn").attr("disabled",!1),!1;if(""==team_id||0==team_id)return art.dialog.alert("请选择群组！"),$("#hdSubmitBtn").attr("disabled",!1),!1}var hd_name=$("#hd_name").val();if(null==hd_name||""==$.trim(hd_name))return art.dialog.alert("名称不能为空！"),$("#hdSubmitBtn").attr("disabled",!1),!1;var start_time=$("#start_time").val();if(null==start_time||""==$.trim(start_time))return art.dialog.alert("开始时间不能为空！"),$("#hdSubmitBtn").attr("disabled",!1),!1;var end_time=$("#end_time").val();if(null==end_time||""==$.trim(end_time))return art.dialog.alert("结束时间不能为空！"),$("#hdSubmitBtn").attr("disabled",!1),!1;if(end_time<start_time)return art.dialog.alert("结束时间不能小于开始时间！"),$("#hdSubmitBtn").attr("disabled",!1),!1;var con_pass=$("#con_pass").val(),reg4con_pass=/^[0-9a-zA-Z]*$/g;if(null==con_pass||""==$.trim(con_pass))return art.dialog.alert("活动密码不能为空,6-10位的数字和字母！"),$("#hdSubmitBtn").attr("disabled",!1),!1;if(con_pass.length<6||con_pass.length>10||!reg4con_pass.test(con_pass))return art.dialog.alert("活动密码格式错误,6-10位的数字和字母！"),$("#hdSubmitBtn").attr("disabled",!1),!1;if(hd_content.replace(/<[^>]+>/g,"").length>120)return art.dialog.alert("内容字数不能大于120字!"),$("#hdSubmitBtn").attr("disabled",!1),!1;var dataFormat={hd_id:hd_id,stage_id:stage_id,stage_name:stage_name,subject_id:subject_id,subject_name:subject_name,lx_id:lx_id,lx_name:lx_name,team_type:team_type,team_id:team_id,team_name:team_name,hd_content:hd_content,hd_name:hd_name,start_time:start_time,end_time:end_time,con_pass:con_pass,is_show:is_show,business_type:business_type,business_id:business_id},url=url_path_html+"/yx/hd/save?t="+Math.random();hd_id>0?(dataFormat.method="edit",dataFormat.hd_confid=hd_confid,can_change_meeting=1==can_change_meeting?detail.start_time==start_time&&detail.end_time==end_time&&detail.con_pass==con_pass?0:1:0,dataFormat.can_change_meeting=can_change_meeting):dataFormat.method="add",$.ajax({async:!0,url:url,type:"post",data:dataFormat,dataType:"json",success:function(data){data.success?(dialogClose(0==hd_id?"添加成功！":"修改成功！",3,200,""),setTimeout(function(){if(null!=callBack){var fun="parent."+callBack+"()";eval(fun)}cannel()},2e3)):dialogClose("系统繁忙！",3,200,"")}})}function cannel(){"undefined"!=typeof parent.tb_remove&&parent.tb_remove()}var business_type=0,business_id=0,hd_id=0,hd_confid=0,callBack=null,can_change_meeting=1;$(document).ready(function(){undefined!=$.cookie("person_id")&&"null"!=$.cookie("person_id")&&5==$.cookie("identity_id")?(null!=GetQueryString("business_type")&&null!=GetQueryString("business_id")&&(business_type=GetQueryString("business_type"),business_id=GetQueryString("business_id")),null!=GetQueryString("callBack")&&(callBack=GetQueryString("callBack")),null!=GetQueryString("team_type")&&$("#team_type").val(GetQueryString("team_type")),null!=GetQueryString("team_id")&&($("#team_select").hide(),$("#team_id").val(GetQueryString("team_id"))),loadHdlx(function(){null!=GetQueryString("id")&&(hd_id=GetQueryString("id")),hd_id>0?initBusiness():initDefaultPlugins()})):alert("未登录")});var detail=null;